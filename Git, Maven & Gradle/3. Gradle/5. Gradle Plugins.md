## Overview

Plugins extend Gradle's capabilities by adding tasks, configurations, and conventions. They enable you to apply common build logic, integrate with frameworks, and customize your build process without writing custom code.

```
┌─────────────────────────────────────────────────────────────────┐
│                     GRADLE PLUGIN SYSTEM                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Core Plugins (Built-in)                                        │
│  ├── java, java-library                                        │
│  ├── application, war                                          │
│  ├── groovy, scala, kotlin                                     │
│  └── maven-publish, signing                                    │
│       ↓                                                         │
│  Community Plugins (Plugin Portal)                              │
│  ├── Spring Boot                                                │
│  ├── Shadow (fat JAR)                                          │
│  ├── JaCoCo (coverage)                                         │
│  └── Spotless (formatting)                                     │
│       ↓                                                         │
│  Custom Plugins                                                 │
│  ├── buildSrc plugins                                          │
│  ├── Included builds                                           │
│  └── Published plugins                                         │
│                                                                 │
│  Plugin Contributions:                                          │
│  ✓ Tasks                                                        │
│  ✓ Configurations                                               │
│  ✓ Extensions                                                   │
│  ✓ Conventions                                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1. Core Plugins

### 1.1 Java Plugin

**Most fundamental plugin for Java projects**

```groovy
plugins {
    id 'java'
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

dependencies {
    implementation 'org.slf4j:slf4j-api:2.0.9'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.0'
}

test {
    useJUnitPlatform()
}
```

**Provided Tasks:**

```
Compilation:
  compileJava        - Compile Java sources
  compileTestJava    - Compile test sources
  processResources   - Copy resources
  classes            - Assemble classes

Verification:
  test               - Run tests
  check              - Run all verification tasks

Build:
  jar                - Create JAR file
  assemble           - Assemble all artifacts
  build              - Full build (assemble + check)
  clean              - Delete build directory

Documentation:
  javadoc            - Generate Javadoc
```

**Source Sets:**

```groovy
// Default source sets
sourceSets {
    main {
        java {
            srcDir 'src/main/java'
        }
        resources {
            srcDir 'src/main/resources'
        }
    }
    test {
        java {
            srcDir 'src/test/java'
        }
        resources {
            srcDir 'src/test/resources'
        }
    }
}

// Custom source sets
sourceSets {
    integration {
        java {
            srcDir 'src/integration/java'
        }
        resources {
            srcDir 'src/integration/resources'
        }
    }
}

// Use custom source set
dependencies {
    integrationImplementation 'org.testcontainers:testcontainers:1.19.1'
}
```

**Configurations:**

```
implementation           - Compile + Runtime
api                      - Compile + Runtime (exposed, needs java-library)
compileOnly              - Compile only
runtimeOnly              - Runtime only
testImplementation       - Test compile + runtime
testCompileOnly          - Test compile only
testRuntimeOnly          - Test runtime only
```

---

### 1.2 Java Library Plugin

**For library projects (exposes API)**

```groovy
plugins {
    id 'java-library'
}

dependencies {
    // Public API (exposed to consumers)
    api 'org.slf4j:slf4j-api:2.0.9'
    api 'javax.validation:validation-api:2.0.1.Final'
    
    // Implementation details (not exposed)
    implementation 'com.google.guava:guava:32.1.3-jre'
    implementation 'org.apache.commons:commons-lang3:3.13.0'
}
```

**API vs Implementation:**

```
api:
  ✓ Exposed to consumers
  ✓ Part of public contract
  ✓ Used in public method signatures
  ✗ Slower builds (consumers recompile on change)

implementation:
  ✓ Not exposed to consumers
  ✓ Faster builds
  ✓ Better encapsulation
  ✗ Consumers cannot use these classes
```

**Example:**

```java
// Library code
package com.example.library;

import org.slf4j.Logger;  // api dependency
import com.google.common.base.Strings;  // implementation dependency

public class MyLibrary {
    // Consumers can use Logger (api)
    public Logger getLogger() {
        return logger;
    }
    
    // Consumers cannot use Strings (implementation)
    private boolean isEmpty(String str) {
        return Strings.isNullOrEmpty(str);  // Internal use only
    }
}
```

---

### 1.3 Application Plugin

**For executable applications**

```groovy
plugins {
    id 'java'
    id 'application'
}

application {
    mainClass = 'com.example.Main'
    applicationName = 'my-app'
    applicationDefaultJvmArgs = ['-Xms256m', '-Xmx1024m']
}

dependencies {
    implementation 'org.slf4j:slf4j-api:2.0.9'
    runtimeOnly 'ch.qos.logback:logback-classic:1.4.11'
}
```

**Provided Tasks:**

```bash
# Run application
./gradlew run

# Create distributions
./gradlew distZip          # ZIP distribution
./gradlew distTar          # TAR distribution
./gradlew installDist      # Install to build/install

# Start scripts
./gradlew startScripts     # Generate start scripts
```

**Distribution Structure:**

```
build/distributions/my-app.zip
  my-app/
  ├── bin/
  │   ├── my-app       (Unix script)
  │   └── my-app.bat   (Windows script)
  └── lib/
      ├── my-app.jar
      ├── slf4j-api.jar
      └── logback-classic.jar
```

**Custom Run Configuration:**

```groovy
run {
    // JVM arguments
    jvmArgs = ['-Xmx512m', '-Dspring.profiles.active=dev']
    
    // Program arguments
    args = ['--config', 'config.yml']
    
    // System properties
    systemProperty 'app.environment', 'development'
    
    // Environment variables
    environment 'APP_ENV', 'dev'
    
    // Working directory
    workingDir = file('runtime')
    
    // Standard input
    standardInput = System.in
}
```

---

### 1.4 WAR Plugin

**For web applications**

```groovy
plugins {
    id 'java'
    id 'war'
}

war {
    archiveBaseName = 'my-webapp'
    archiveVersion = '1.0.0'
    
    // Include/exclude files
    from('src/webapp') {
        include '**/*.jsp'
    }
    
    // Exclude specific files
    exclude '**/test/**'
}

dependencies {
    implementation 'javax.servlet:javax.servlet-api:4.0.1'
    
    // Provided by servlet container
    providedCompile 'javax.servlet:javax.servlet-api:4.0.1'
    
    // Included in WAR
    implementation 'org.springframework:spring-webmvc:6.0.13'
}
```

**WAR Structure:**

```
my-webapp.war
├── META-INF/
│   └── MANIFEST.MF
├── WEB-INF/
│   ├── classes/              (compiled classes)
│   │   └── com/example/
│   ├── lib/                  (dependencies)
│   │   ├── spring-webmvc.jar
│   │   └── ...
│   └── web.xml
└── index.jsp                 (web content)
```

---

### 1.5 Other JVM Language Plugins

**Groovy:**

```groovy
plugins {
    id 'groovy'
}

dependencies {
    implementation 'org.codehaus.groovy:groovy:3.0.19'
    testImplementation 'org.spockframework:spock-core:2.3-groovy-3.0'
}
```

**Kotlin:**

```groovy
plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.9.20'
}

kotlin {
    jvmToolchain(17)
}

dependencies {
    implementation 'org.jetbrains.kotlin:kotlin-stdlib'
    testImplementation 'org.jetbrains.kotlin:kotlin-test'
}
```

**Scala:**

```groovy
plugins {
    id 'scala'
}

dependencies {
    implementation 'org.scala-lang:scala-library:2.13.12'
    testImplementation 'org.scalatest:scalatest_2.13:3.2.17'
}
```

---

## 2. Community Plugins

### 2.1 Spring Boot Plugin

**Official Spring Boot integration**

```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
    id 'io.spring.dependency-management' version '1.1.4'
}

group = 'com.example'
version = '1.0.0-SNAPSHOT'
sourceCompatibility = '17'

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    
    runtimeOnly 'org.postgresql:postgresql'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

test {
    useJUnitPlatform()
}
```

**Provided Tasks:**

```bash
# Run Spring Boot application
./gradlew bootRun

# Create executable JAR
./gradlew bootJar

# Create WAR
./gradlew bootWar

# Build Docker image
./gradlew bootBuildImage
```

**Configuration:**

```groovy
springBoot {
    // Main class
    mainClass = 'com.example.Application'
    
    // Build info
    buildInfo()
}

bootJar {
    archiveBaseName = 'my-service'
    archiveVersion = '1.0.0'
    
    // Layered JAR (for Docker)
    layered {
        enabled = true
    }
    
    // Exclude dev tools
    excludeDevtools = true
    
    // Executable JAR (Unix)
    launchScript()
}

bootRun {
    // JVM arguments
    jvmArgs = ['-Xmx512m']
    
    // Spring profiles
    systemProperty 'spring.profiles.active', 'dev'
    
    // Arguments
    args = ['--server.port=8081']
}

// Docker image
bootBuildImage {
    imageName = 'docker.io/myorg/my-service:1.0.0'
    
    environment = [
        'BP_JVM_VERSION': '17',
        'BPE_DELIM_JAVA_TOOL_OPTIONS': ' ',
        'BPE_APPEND_JAVA_TOOL_OPTIONS': '-XX:MaxMetaspaceSize=128m'
    ]
}
```

**Dependency Management:**

```groovy
// Spring Boot manages versions
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    // No version needed - managed by Spring Boot
}

// Override managed version
ext['slf4j.version'] = '2.0.9'

// Or
dependencies {
    implementation 'org.slf4j:slf4j-api:2.0.9'  // Explicit version
}
```

---

### 2.2 Shadow Plugin (Fat JAR)

**Creates uber/fat JAR with all dependencies**

```groovy
plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

shadowJar {
    archiveBaseName = 'my-app'
    archiveClassifier = 'all'
    archiveVersion = '1.0.0'
    
    // Main class
    manifest {
        attributes 'Main-Class': 'com.example.Main'
    }
    
    // Merge service files
    mergeServiceFiles()
    
    // Relocate packages (avoid conflicts)
    relocate 'com.google.common', 'shadow.com.google.common'
    
    // Exclude files
    exclude 'META-INF/*.SF'
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/*.RSA'
    
    // Minimize (remove unused classes)
    minimize()
}

// Run shadow JAR
task runShadow(type: JavaExec) {
    classpath = shadowJar.outputs.files
    mainClass = 'com.example.Main'
}
```

**Tasks:**

```bash
# Create shadow JAR
./gradlew shadowJar

# Output: build/libs/my-app-1.0.0-all.jar

# Run shadow JAR
java -jar build/libs/my-app-1.0.0-all.jar
```

**Use Cases:**

```
✓ Standalone applications
✓ AWS Lambda functions
✓ Command-line tools
✓ No dependency conflicts
✓ Single JAR deployment
```

---

### 2.3 Versions Plugin

**Check for dependency updates**

```groovy
plugins {
    id 'java'
    id 'com.github.ben-manes.versions' version '0.50.0'
}

tasks.named('dependencyUpdates').configure {
    // Reject release candidates
    rejectVersionIf {
        isNonStable(it.candidate.version)
    }
    
    // Check for updates every 24 hours
    revision = 'release'
    
    // Output formats
    outputFormatter = 'json'
    outputDir = 'build/dependencyUpdates'
}

def isNonStable(String version) {
    def stableKeyword = ['RELEASE', 'FINAL', 'GA'].any { 
        version.toUpperCase().contains(it) 
    }
    def regex = /^[0-9,.v-]+(-r)?$/
    return !stableKeyword && !(version ==~ regex)
}
```

**Tasks:**

```bash
# Check for updates
./gradlew dependencyUpdates

# Output example:
The following dependencies have later release versions:
 - org.springframework.boot:spring-boot-starter-web [3.1.5 -> 3.2.0]
 - com.google.guava:guava [32.1.3-jre -> 33.0.0-jre]
```

---

### 2.4 Spotless Plugin

**Code formatting**

```groovy
plugins {
    id 'java'
    id 'com.diffplug.spotless' version '6.23.3'
}

spotless {
    java {
        // Google Java Format
        googleJavaFormat('1.18.1').aosp().reflowLongStrings()
        
        // Or Eclipse formatter
        // eclipse().configFile('eclipse-formatter.xml')
        
        // Remove unused imports
        removeUnusedImports()
        
        // Trim trailing whitespace
        trimTrailingWhitespace()
        
        // End files with newline
        endWithNewline()
        
        // Apply to specific files
        target 'src/**/*.java'
        targetExclude 'src/generated/**'
    }
    
    groovy {
        greclipse()
        indentWithSpaces(4)
    }
    
    kotlin {
        ktlint('1.0.1')
        target 'src/**/*.kt'
    }
    
    format 'misc' {
        target '*.gradle', '*.md', '.gitignore'
        trimTrailingWhitespace()
        endWithNewline()
    }
}
```

**Tasks:**

```bash
# Check formatting
./gradlew spotlessCheck

# Apply formatting
./gradlew spotlessApply

# Check Java only
./gradlew spotlessJavaCheck

# Apply to specific format
./gradlew spotlessJavaApply
```

**CI Integration:**

```groovy
// Fail build on formatting issues
check.dependsOn spotlessCheck

// Or auto-format before build
build.dependsOn spotlessApply
```

---

### 2.5 JaCoCo Plugin (Code Coverage)

**Code coverage reporting**

```groovy
plugins {
    id 'java'
    id 'jacoco'
}

jacoco {
    toolVersion = '0.8.11'
}

test {
    useJUnitPlatform()
    
    finalizedBy jacocoTestReport
}

jacocoTestReport {
    dependsOn test
    
    reports {
        xml.required = true
        html.required = true
        csv.required = false
        
        xml.outputLocation = file("${buildDir}/reports/jacoco/test/jacocoTestReport.xml")
        html.outputLocation = file("${buildDir}/reports/jacoco/test/html")
    }
    
    // Exclude generated code
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, exclude: [
                '**/generated/**',
                '**/config/**',
                '**/*Config.class',
                '**/*Application.class'
            ])
        }))
    }
}

// Coverage verification
jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.80  // 80% coverage
            }
        }
        
        rule {
            element = 'CLASS'
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.60
            }
            excludes = [
                '*.config.*',
                '*.Application'
            ]
        }
    }
}

check.dependsOn jacocoTestCoverageVerification
```

**Tasks:**

```bash
# Run tests and generate report
./gradlew test jacocoTestReport

# Verify coverage
./gradlew jacocoTestCoverageVerification

# View report
open build/reports/jacoco/test/html/index.html
```

---

### 2.6 Other Useful Plugins

**Checkstyle (Code Quality):**

```groovy
plugins {
    id 'checkstyle'
}

checkstyle {
    toolVersion = '10.12.5'
    configFile = file('config/checkstyle/checkstyle.xml')
    ignoreFailures = false
}

checkstyleMain {
    source = 'src/main/java'
}
```

**PMD (Static Analysis):**

```groovy
plugins {
    id 'pmd'
}

pmd {
    toolVersion = '6.55.0'
    ruleSetFiles = files('config/pmd/ruleset.xml')
    ignoreFailures = false
}
```

**SpotBugs (Bug Detection):**

```groovy
plugins {
    id 'com.github.spotbugs' version '6.0.4'
}

spotbugs {
    toolVersion = '4.8.2'
    ignoreFailures = false
    reportLevel = 'medium'
}
```

**Dependency Analysis:**

```groovy
plugins {
    id 'com.autonomousapps.dependency-analysis' version '1.28.0'
}

dependencyAnalysis {
    issues {
        all {
            onAny {
                severity('fail')
            }
        }
    }
}
```

---

## 3. Applying Plugins

### 3.1 Plugins DSL (Recommended)

```groovy
plugins {
    // Core plugins (no version)
    id 'java'
    id 'application'
    id 'maven-publish'
    
    // Community plugins (with version)
    id 'org.springframework.boot' version '3.2.0'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
    id 'com.diffplug.spotless' version '6.23.3'
    
    // Kotlin DSL
    kotlin("jvm") version "1.9.20"
}
```

**Benefits:**

```
✓ Type-safe (especially with Kotlin DSL)
✓ IDE support (autocomplete)
✓ Version management
✓ Plugin resolution optimization
✓ Early configuration
```

---

### 3.2 Legacy apply (Deprecated)

```groovy
// Old way (buildscript + apply)
buildscript {
    repositories {
        gradlePluginPortal()
        mavenCentral()
    }
    dependencies {
        classpath 'org.springframework.boot:spring-boot-gradle-plugin:3.2.0'
    }
}

apply plugin: 'java'
apply plugin: 'org.springframework.boot'

// Modern way (plugins DSL)
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
}
```

**When to Use apply:**

```
✓ Plugins from buildSrc
✓ Plugins from includedBuild
✓ Conditional plugin application
✓ Backward compatibility
```

---

### 3.3 Conditional Plugin Application

```groovy
// Plugins DSL doesn't support conditions directly
plugins {
    id 'java'
}

// Apply conditionally with apply
if (project.hasProperty('enableSpringBoot')) {
    apply plugin: 'org.springframework.boot'
}

// Or use plugin management in settings.gradle
// settings.gradle
pluginManagement {
    plugins {
        id 'org.springframework.boot' version '3.2.0'
    }
}

// build.gradle
plugins {
    id 'java'
    if (enableSpringBoot) {
        id 'org.springframework.boot'
    }
}
```

---

### 3.4 Plugin Management (settings.gradle)

```groovy
// settings.gradle
pluginManagement {
    repositories {
        gradlePluginPortal()
        mavenCentral()
        maven {
            url 'https://plugins.company.com/m2'
        }
    }
    
    plugins {
        id 'org.springframework.boot' version '3.2.0'
        id 'io.spring.dependency-management' version '1.1.4'
        id 'com.github.johnrengelman.shadow' version '8.1.1'
    }
    
    resolutionStrategy {
        eachPlugin {
            if (requested.id.id == 'com.company.custom-plugin') {
                useModule('com.company:custom-plugin:1.0.0')
            }
        }
    }
}

// build.gradle (no version needed)
plugins {
    id 'org.springframework.boot'  // Version from settings.gradle
    id 'io.spring.dependency-management'
}
```

---

## 4. Custom Plugins

### 4.1 Inline Plugin (build.gradle)

```groovy
// Simple inline plugin
class GreetingPlugin implements Plugin<Project> {
    void apply(Project project) {
        // Add extension
        project.extensions.create('greeting', GreetingExtension)
        
        // Add task
        project.tasks.register('greet') {
            doLast {
                println "${project.greeting.message} from ${project.greeting.greeter}!"
            }
        }
    }
}

class GreetingExtension {
    String message = 'Hello'
    String greeter = 'Gradle'
}

apply plugin: GreetingPlugin

greeting {
    message = 'Welcome'
    greeter = 'World'
}

// Run: ./gradlew greet
// Output: Welcome from World!
```

---

### 4.2 buildSrc Plugin

**buildSrc/build.gradle:**

```groovy
plugins {
    id 'groovy-gradle-plugin'
}

repositories {
    gradlePluginPortal()
}
```

**buildSrc/src/main/groovy/java-conventions.gradle:**

```groovy
plugins {
    id 'java'
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.0'
}

test {
    useJUnitPlatform()
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
}
```

**Using convention plugin:**

```groovy
// Any subproject
plugins {
    id 'java-conventions'
}

// All common configuration applied automatically!
```

---

### 4.3 Standalone Plugin Project

**plugin/build.gradle:**

```groovy
plugins {
    id 'java-gradle-plugin'
    id 'maven-publish'
}

group = 'com.example'
version = '1.0.0'

gradlePlugin {
    plugins {
        customPlugin {
            id = 'com.example.custom-plugin'
            implementationClass = 'com.example.CustomPlugin'
        }
    }
}

dependencies {
    implementation gradleApi()
}
```

**plugin/src/main/java/com/example/CustomPlugin.java:**

```java
package com.example;

import org.gradle.api.Plugin;
import org.gradle.api.Project;

public class CustomPlugin implements Plugin<Project> {
    @Override
    public void apply(Project project) {
        // Add extension
        CustomExtension extension = project.getExtensions()
            .create("custom", CustomExtension.class);
        
        // Add task
        project.getTasks().register("customTask", CustomTask.class, task -> {
            task.setMessage(extension.getMessage());
        });
    }
}
```

**Publishing:**

```groovy
publishing {
    publications {
        maven(MavenPublication) {
            from components.java
        }
    }
    repositories {
        maven {
            url = 'https://repo.company.com/maven-releases'
        }
    }
}
```

---

## 5. Plugin Best Practices

### 5.1 Choose the Right Plugin Type

```
Inline Plugin (build.gradle):
  ✓ Quick prototypes
  ✓ Project-specific logic
  ✗ Not reusable
  ✗ Hard to test

buildSrc Plugin:
  ✓ Reusable across subprojects
  ✓ Easy to maintain
  ✓ Type-safe
  ✗ Not shareable between projects
  ✗ Increases configuration time

Standalone Plugin:
  ✓ Shareable across projects
  ✓ Versioned
  ✓ Testable
  ✓ Professional
  ✗ More setup required
  ✗ Publishing overhead
```

---

### 5.2 Plugin Ordering Matters

```groovy
plugins {
    // Language plugins first
    id 'java'
    
    // Framework plugins
    id 'org.springframework.boot' version '3.2.0'
    
    // Enhancement plugins last
    id 'jacoco'
    id 'checkstyle'
}

// This order matters because:
// - Spring Boot needs Java plugin applied first
// - JaCoCo needs test tasks from Java plugin
```

---

### 5.3 Configure Plugins Properly

```groovy
// ✗ BAD: Configure before applying
checkstyle {
    configFile = file('config/checkstyle.xml')
}
plugins {
    id 'checkstyle'  // Plugin not yet applied!
}

// ✓ GOOD: Apply then configure
plugins {
    id 'checkstyle'
}
checkstyle {
    configFile = file('config/checkstyle.xml')
}
```

---

## Summary

### Core Plugin Quick Reference

```
java            → Java projects
java-library    → Libraries (api/implementation)
application     → Executable apps
war             → Web applications
groovy          → Groovy projects
kotlin("jvm")   → Kotlin projects
maven-publish   → Publishing to Maven
signing         → Artifact signing
```

### Essential Community Plugins

```
Spring Boot:
  id 'org.springframework.boot' version '3.2.0'
  id 'io.spring.dependency-management' version '1.1.4'

Shadow (Fat JAR):
  id 'com.github.johnrengelman.shadow' version '8.1.1'

Code Quality:
  id 'com.diffplug.spotless' version '6.23.3'  // Formatting
  id 'jacoco'                                  // Coverage
  id 'checkstyle'                              // Style checks
  id 'pmd'                                     // Static analysis

Utilities:
  id 'com.github.ben-manes.versions' version '0.50.0'  // Updates
```

### Plugin Application

```groovy
// Modern (Preferred)
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'
}

// Legacy (Avoid)
apply plugin: 'java'

// Conditional
if (condition) {
    apply plugin: 'some-plugin'
}
```

### Best Practices

```
✓ Use plugins DSL (not apply)
✓ Manage versions in settings.gradle
✓ Apply language plugins first
✓ Configure after applying
✓ Use convention plugins for shared config
✓ Keep plugins up-to-date
✓ Test custom plugins
```
