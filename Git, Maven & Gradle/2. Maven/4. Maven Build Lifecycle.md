## Overview

Maven is built around the concept of build lifecycles. A lifecycle is a well-defined sequence of phases that define the order in which goals are executed. Understanding lifecycles is essential for effective Maven usage.

```
┌─────────────────────────────────────────────────────────────────┐
│                    MAVEN BUILD LIFECYCLES                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  CLEAN Lifecycle:                                               │
│  pre-clean → clean → post-clean                                │
│  Purpose: Clean up build artifacts                             │
│                                                                 │
│  DEFAULT Lifecycle:                                             │
│  validate → compile → test → package → verify → install        │
│  → deploy                                                       │
│  Purpose: Build and distribute the project                     │
│                                                                 │
│  SITE Lifecycle:                                                │
│  pre-site → site → post-site → site-deploy                    │
│  Purpose: Generate project documentation                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1. Three Built-in Lifecycles

Maven has three independent built-in lifecycles that can be executed separately or together.

### Clean Lifecycle

**Purpose:** Remove all files generated by the previous build

**Phases:**

```
1. pre-clean    → Execute processes needed before cleanup
2. clean        → Remove all files from target directory
3. post-clean   → Execute processes needed after cleanup
```

**Commands:**

```bash
# Run clean phase (and pre-clean)
mvn clean

# Run post-clean as well
mvn post-clean

# Clean is often combined with other lifecycles
mvn clean install
mvn clean package
mvn clean test
```

**What Gets Cleaned:**

```bash
# Before clean
project/
├── target/              # ← This entire directory is deleted
│   ├── classes/
│   ├── test-classes/
│   ├── my-app-1.0.0.jar
│   └── surefire-reports/
├── src/
└── pom.xml

# After mvn clean
project/
├── src/
└── pom.xml              # target/ is gone
```

**Custom Clean Configuration:**

```xml
<build>
    <plugins>
        <plugin>
            <artifactId>maven-clean-plugin</artifactId>
            <version>3.3.1</version>
            <configuration>
                <!-- Additional directories to clean -->
                <filesets>
                    <fileset>
                        <directory>logs</directory>
                        <includes>
                            <include>**/*.log</include>
                        </includes>
                    </fileset>
                    <fileset>
                        <directory>generated-sources</directory>
                    </fileset>
                </filesets>
            </configuration>
        </plugin>
    </plugins>
</build>
```

---

### Default Lifecycle (Most Important)

**Purpose:** Build and deploy the project

**Complete Phase List:**

```
1.  validate              → Validate project is correct
2.  initialize            → Initialize build state
3.  generate-sources      → Generate source code
4.  process-sources       → Process source code
5.  generate-resources    → Generate resources
6.  process-resources     → Copy and process resources
7.  compile               → Compile source code
8.  process-classes       → Post-process compiled files
9.  generate-test-sources → Generate test source code
10. process-test-sources  → Process test source code
11. generate-test-resources → Generate test resources
12. process-test-resources → Copy and process test resources
13. test-compile          → Compile test source code
14. process-test-classes  → Post-process test compiled files
15. test                  → Run unit tests
16. prepare-package       → Prepare for packaging
17. package               → Package compiled code (JAR/WAR)
18. pre-integration-test  → Prepare for integration tests
19. integration-test      → Run integration tests
20. post-integration-test → Clean up after integration tests
21. verify                → Check package is valid
22. install               → Install to local repository
23. deploy                → Deploy to remote repository
```

**Common Phases (You'll Use Daily):**

```
validate  → Check if project is correct
compile   → Compile source code
test      → Run unit tests
package   → Create JAR/WAR
verify    → Run integration tests
install   → Install to local repository
deploy    → Deploy to remote repository
```

---

### Site Lifecycle

**Purpose:** Generate project documentation and reports

**Phases:**

```
1. pre-site     → Execute processes before site generation
2. site         → Generate site documentation
3. post-site    → Execute processes after site generation
4. site-deploy  → Deploy generated site to server
```

**Commands:**

```bash
# Generate site documentation
mvn site

# Deploy site to server
mvn site-deploy

# Generate and view site locally
mvn site
# Open target/site/index.html in browser
```

**What Site Generates:**

```
target/site/
├── index.html                    # Project homepage
├── project-info.html             # Project information
├── dependencies.html             # Dependency report
├── dependency-convergence.html   # Dependency conflicts
├── plugins.html                  # Plugin report
├── surefire-report.html         # Test results
├── jacoco/                       # Code coverage
├── checkstyle.html              # Code style report
└── pmd.html                     # PMD report
```

**Configure Site Plugin:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-site-plugin</artifactId>
            <version>4.0.0-M9</version>
        </plugin>
    </plugins>
</build>

<reporting>
    <plugins>
        <!-- Surefire Test Report -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-report-plugin</artifactId>
            <version>3.1.2</version>
        </plugin>
        
        <!-- JaCoCo Code Coverage -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.10</version>
        </plugin>
        
        <!-- JavaDoc -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-javadoc-plugin</artifactId>
            <version>3.5.0</version>
        </plugin>
    </plugins>
</reporting>
```

---

## 2. Default Lifecycle Phases (Detailed)

### Validate Phase

```bash
mvn validate
```

**Purpose:**

- Validate project is correct and all necessary information is available
- Check POM is valid
- Verify required properties are set

**What Happens:**

```
✓ Parse pom.xml
✓ Check required elements (groupId, artifactId, version)
✓ Validate dependencies exist
✓ Check plugin configuration
✓ Verify properties are defined
```

**Rarely Used Directly:**

- Usually part of other phases
- Useful for CI/CD pipeline validation
- Quick project health check

---

### Compile Phase

```bash
mvn compile
```

**Purpose:** Compile the main source code

**What Happens:**

```
1. Process resources (copy files from src/main/resources)
2. Compile Java files (src/main/java → target/classes)
3. Process compiled classes (if needed)
```

**Output:**

```
Before:
src/main/java/com/company/App.java

After:
target/classes/com/company/App.class
target/classes/application.properties  # From src/main/resources
```

**Bound Plugin Goals:**

```
maven-resources-plugin:resources
maven-compiler-plugin:compile
```

**Configure Compiler:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.11.0</version>
            <configuration>
                <source>17</source>
                <target>17</target>
                <encoding>UTF-8</encoding>
                <showWarnings>true</showWarnings>
                <showDeprecation>true</showDeprecation>
                <compilerArgs>
                    <arg>-parameters</arg>
                    <arg>-Xlint:unchecked</arg>
                </compilerArgs>
            </configuration>
        </plugin>
    </plugins>
</build>
```

---

### Test Phase

```bash
mvn test
```

**Purpose:** Run unit tests using Surefire plugin

**What Happens:**

```
1. Process test resources (src/test/resources → target/test-classes)
2. Compile test code (src/test/java → target/test-classes)
3. Run unit tests (*Test.java, *Tests.java, Test*.java)
4. Generate test reports (target/surefire-reports)
```

**Test Execution:**

```
[INFO] --- maven-surefire-plugin:3.1.2:test (default-test) ---
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.company.service.UserServiceTest
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.234 s
[INFO] Running com.company.repository.UserRepositoryTest
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.567 s
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] BUILD SUCCESS
```

**Test Reports:**

```
target/surefire-reports/
├── com.company.service.UserServiceTest.txt
├── TEST-com.company.service.UserServiceTest.xml
├── com.company.repository.UserRepositoryTest.txt
└── TEST-com.company.repository.UserRepositoryTest.xml
```

**Surefire Configuration:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>3.1.2</version>
            <configuration>
                <!-- Test pattern -->
                <includes>
                    <include>**/*Test.java</include>
                    <include>**/*Tests.java</include>
                    <include>**/Test*.java</include>
                </includes>
                
                <!-- Exclude integration tests -->
                <excludes>
                    <exclude>**/*IT.java</exclude>
                    <exclude>**/*IntegrationTest.java</exclude>
                </excludes>
                
                <!-- Parallel execution -->
                <parallel>methods</parallel>
                <threadCount>4</threadCount>
                
                <!-- System properties -->
                <systemPropertyVariables>
                    <test.environment>unit</test.environment>
                </systemPropertyVariables>
            </configuration>
        </plugin>
    </plugins>
</build>
```

**Skip Tests:**

```bash
# Skip test execution (but compile tests)
mvn package -DskipTests

# Skip test compilation and execution
mvn package -Dmaven.test.skip=true

# Skip only specific test
mvn test -Dtest=UserServiceTest

# Run specific test method
mvn test -Dtest=UserServiceTest#shouldCreateUser

# Run tests matching pattern
mvn test -Dtest=*ServiceTest
```

---

### Package Phase

```bash
mvn package
```

**Purpose:** Package compiled code into distributable format (JAR/WAR)

**What Happens:**

```
1. Run all previous phases (validate → compile → test)
2. Package compiled classes and resources
3. Create JAR/WAR in target directory
```

**For JAR Projects:**

```xml
<packaging>jar</packaging>
```

**Output:**

```
target/
├── classes/
├── test-classes/
├── my-application-1.0.0.jar        # ← Created here
└── surefire-reports/
```

**JAR Contents:**

```
my-application-1.0.0.jar
├── com/company/app/
│   ├── Main.class
│   ├── service/
│   └── repository/
├── application.properties
├── static/
├── templates/
└── META-INF/
    ├── MANIFEST.MF
    └── maven/
        └── com.company.app/
            └── my-application/
                ├── pom.xml
                └── pom.properties
```

**For WAR Projects:**

```xml
<packaging>war</packaging>
```

**Output:**

```
target/
└── my-webapp-1.0.0.war
```

**WAR Contents:**

```
my-webapp-1.0.0.war
├── WEB-INF/
│   ├── classes/          # Compiled classes
│   ├── lib/              # Dependencies
│   ├── web.xml
│   └── views/
├── index.html
├── css/
├── js/
└── images/
```

**Configure JAR Plugin:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-jar-plugin</artifactId>
            <version>3.3.0</version>
            <configuration>
                <archive>
                    <manifest>
                        <!-- Add classpath to manifest -->
                        <addClasspath>true</addClasspath>
                        <classpathPrefix>lib/</classpathPrefix>
                        
                        <!-- Main class for executable JAR -->
                        <mainClass>com.company.app.Main</mainClass>
                    </manifest>
                    <manifestEntries>
                        <Built-By>${user.name}</Built-By>
                        <Build-Time>${maven.build.timestamp}</Build-Time>
                        <Implementation-Version>${project.version}</Implementation-Version>
                    </manifestEntries>
                </archive>
            </configuration>
        </plugin>
    </plugins>
</build>
```

**Spring Boot Fat JAR:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <version>3.1.5</version>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

---

### Verify Phase

```bash
mvn verify
```

**Purpose:** Run integration tests and validation checks

**What Happens:**

```
1. Run all phases through package
2. Run integration tests (Failsafe plugin)
3. Verify package meets quality criteria
```

**Integration Tests:**

```
src/test/java/
├── com/company/app/
│   ├── UserServiceTest.java           # Unit test (Surefire)
│   └── UserServiceIT.java             # Integration test (Failsafe)
```

**Failsafe Plugin Configuration:**

```xml
<build>
    <plugins>
        <!-- Failsafe for integration tests -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <version>3.1.2</version>
            <configuration>
                <includes>
                    <include>**/*IT.java</include>
                    <include>**/*IntegrationTest.java</include>
                </includes>
            </configuration>
            <executions>
                <execution>
                    <goals>
                        <goal>integration-test</goal>
                        <goal>verify</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

**Difference: Surefire vs Failsafe:**

```
┌────────────────────────────────────────────────────────────┐
│           SUREFIRE vs FAILSAFE                             │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  Surefire (Unit Tests):                                   │
│  - Phase: test                                             │
│  - Pattern: *Test.java, Test*.java, *Tests.java          │
│  - Fails build immediately on test failure                │
│  - Fast execution                                          │
│                                                            │
│  Failsafe (Integration Tests):                            │
│  - Phase: integration-test, verify                        │
│  - Pattern: *IT.java, *IntegrationTest.java              │
│  - Doesn't fail build during integration-test phase       │
│  - Fails during verify phase (allows cleanup)             │
│  - Slower execution                                        │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**Why Failsafe Waits:**

```
integration-test phase:
  1. Start database container
  2. Run integration tests
  3. [Tests fail but build continues]
  4. Stop database container     ← Cleanup happens!

verify phase:
  5. Check test results
  6. [Build fails here if tests failed]
```

---

### Install Phase

```bash
mvn install
```

**Purpose:** Install package to local repository (~/.m2/repository)

**What Happens:**

```
1. Run all phases through verify
2. Copy JAR/WAR to local repository
3. Copy POM to local repository
4. Generate maven-metadata-local.xml
```

**Result:**

```
~/.m2/repository/
└── com/
    └── company/
        └── my-application/
            └── 1.0.0-SNAPSHOT/
                ├── my-application-1.0.0-SNAPSHOT.jar
                ├── my-application-1.0.0-SNAPSHOT.pom
                ├── _remote.repositories
                └── maven-metadata-local.xml
```

**When to Use Install:**

```bash
# Install to local repo for other projects to use
mvn clean install

# Install without running tests
mvn clean install -DskipTests

# Install specific module in multi-module project
mvn clean install -pl my-module -am
```

**Install Plugin Configuration:**

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-install-plugin</artifactId>
            <version>3.1.1</version>
            <configuration>
                <createChecksum>true</createChecksum>
            </configuration>
        </plugin>
    </plugins>
</build>
```

---

### Deploy Phase

```bash
mvn deploy
```

**Purpose:** Deploy package to remote repository (Nexus, Artifactory)

**What Happens:**

```
1. Run all phases through install
2. Upload JAR/WAR to remote repository
3. Upload POM to remote repository
4. Update repository metadata
```

**Configure Distribution Management:**

```xml
<distributionManagement>
    <!-- Release repository -->
    <repository>
        <id>company-releases</id>
        <n>Company Release Repository</n>
        <url>https://nexus.company.com/repository/maven-releases/</url>
    </repository>
    
    <!-- Snapshot repository -->
    <snapshotRepository>
        <id>company-snapshots</id>
        <n>Company Snapshot Repository</n>
        <url>https://nexus.company.com/repository/maven-snapshots/</url>
    </snapshotRepository>
</distributionManagement>
```

**Configure Credentials (in settings.xml):**

```xml
<!-- ~/.m2/settings.xml -->
<settings>
    <servers>
        <server>
            <id>company-releases</id>
            <username>${env.NEXUS_USERNAME}</username>
            <password>${env.NEXUS_PASSWORD}</password>
        </server>
        <server>
            <id>company-snapshots</id>
            <username>${env.NEXUS_USERNAME}</username>
            <password>${env.NEXUS_PASSWORD}</password>
        </server>
    </servers>
</settings>
```

**Deploy Commands:**

```bash
# Deploy to remote repository
mvn clean deploy

# Deploy without tests
mvn clean deploy -DskipTests

# Deploy only (skip install)
mvn deploy -DskipLocalInstall

# Deploy specific file
mvn deploy:deploy-file \
  -DgroupId=com.company \
  -DartifactId=my-app \
  -Dversion=1.0.0 \
  -Dpackaging=jar \
  -Dfile=target/my-app-1.0.0.jar \
  -DrepositoryId=company-releases \
  -Durl=https://nexus.company.com/repository/maven-releases/
```

**SNAPSHOT vs Release Deployment:**

```
SNAPSHOT (1.0.0-SNAPSHOT):
  - Deployed to snapshot repository
  - Can be overwritten (multiple deploys)
  - Maven checks for updates (daily/always)
  - Filename includes timestamp: my-app-1.0.0-20241115.103045-1.jar

RELEASE (1.0.0):
  - Deployed to release repository
  - Cannot be overwritten (immutable)
  - Cached permanently
  - Filename stays same: my-app-1.0.0.jar
```

---

## 3. Phase Execution

### Sequential Execution

Running a phase executes all previous phases in order.

```bash
# Running 'package' executes:
mvn package

# Actual execution order:
# 1. validate
# 2. initialize  
# 3. generate-sources
# 4. process-sources
# 5. generate-resources
# 6. process-resources
# 7. compile
# 8. process-classes
# 9. generate-test-sources
# 10. process-test-sources
# 11. generate-test-resources
# 12. process-test-resources
# 13. test-compile
# 14. process-test-classes
# 15. test
# 16. prepare-package
# 17. package  ← Stops here
```

**Visual Representation:**

```
┌─────────────────────────────────────────────────────────────┐
│              PHASE EXECUTION CHAIN                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  mvn validate                                               │
│  ↓                                                          │
│  [validate]                                                 │
│                                                             │
│  mvn compile                                                │
│  ↓                                                          │
│  [validate] → [process-resources] → [compile]              │
│                                                             │
│  mvn test                                                   │
│  ↓                                                          │
│  [validate] → [compile] → [test-compile] → [test]          │
│                                                             │
│  mvn package                                                │
│  ↓                                                          │
│  [validate] → [compile] → [test] → [package]               │
│                                                             │
│  mvn verify                                                 │
│  ↓                                                          │
│  [validate] → [compile] → [test] → [package] → [verify]    │
│                                                             │
│  mvn install                                                │
│  ↓                                                          │
│  [validate] → ... → [package] → [verify] → [install]       │
│                                                             │
│  mvn deploy                                                 │
│  ↓                                                          │
│  [validate] → ... → [verify] → [install] → [deploy]        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### Combining Lifecycles

Different lifecycles can be combined in a single command.

```bash
# Clean before building
mvn clean install

# Execution order:
# Clean lifecycle: pre-clean → clean → post-clean
# Default lifecycle: validate → ... → install

# Clean, build, and generate site
mvn clean install site

# Clean, build, skip tests
mvn clean package -DskipTests

# Clean, verify with integration tests
mvn clean verify
```

---

### Skipping Phases

**Skip Tests:**

```bash
# Skip test execution (compile tests but don't run)
mvn package -DskipTests

# Skip test compilation and execution
mvn package -Dmaven.test.skip=true

# Skip only integration tests
mvn verify -DskipITs

# Skip only unit tests (run integration tests)
mvn verify -DskipTests -DskipITs=false
```

**Configure in POM:**

```xml
<properties>
    <!-- Skip tests by default -->
    <maven.test.skip>false</maven.test.skip>
    <skipTests>false</skipTests>
    <skipITs>false</skipITs>
</properties>

<build>
    <plugins>
        <!-- Surefire (unit tests) -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <configuration>
                <skipTests>${skipTests}</skipTests>
            </configuration>
        </plugin>
        
        <!-- Failsafe (integration tests) -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <configuration>
                <skipTests>${skipTests}</skipTests>
                <skipITs>${skipITs}</skipITs>
            </configuration>
        </plugin>
    </plugins>
</build>
```

**Skip Other Plugins:**

```bash
# Skip JavaDoc generation
mvn package -Dmaven.javadoc.skip=true

# Skip source JAR creation
mvn package -Dmaven.source.skip=true

# Skip deployment
mvn install -Dmaven.deploy.skip=true
```

---

## 4. Goals vs Phases

### Understanding the Difference

```
┌────────────────────────────────────────────────────────────┐
│                 PHASE vs GOAL                              │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  PHASE:                                                    │
│  - Step in build lifecycle                                 │
│  - Abstract concept                                        │
│  - Executed with: mvn <phase>                             │
│  - Example: compile, test, package                        │
│                                                            │
│  GOAL:                                                     │
│  - Specific task performed by a plugin                    │
│  - Concrete implementation                                 │
│  - Executed with: mvn <plugin>:<goal>                     │
│  - Example: compiler:compile, surefire:test               │
│                                                            │
│  BINDING:                                                  │
│  - Goals are bound to phases                              │
│  - When phase runs, bound goals execute                   │
│  - One phase can have multiple goals                      │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

### Phases

Phases are stages in the build lifecycle.

```bash
# Run a phase
mvn compile        # Run compile phase
mvn test          # Run test phase
mvn package       # Run package phase

# Running a phase executes all previous phases
mvn package       # Runs: validate → compile → test → package
```

**Common Phases:**

```bash
mvn validate      # Validate project
mvn compile       # Compile source
mvn test          # Run unit tests
mvn package       # Create JAR/WAR
mvn verify        # Run integration tests
mvn install       # Install to local repo
mvn deploy        # Deploy to remote repo
```

---

### Goals

Goals are specific tasks performed by plugins.

```bash
# Run a goal directly
mvn compiler:compile           # Run compiler plugin's compile goal
mvn surefire:test             # Run surefire plugin's test goal
mvn dependency:tree           # Show dependency tree
mvn help:effective-pom        # Show effective POM

# Goal syntax: <plugin-prefix>:<goal>
mvn clean:clean               # Clean plugin, clean goal
mvn jar:jar                   # JAR plugin, jar goal
mvn install:install           # Install plugin, install goal
```

**Common Plugin Goals:**

```bash
# Dependency plugin
mvn dependency:tree           # Show dependency tree
mvn dependency:analyze        # Analyze dependencies
mvn dependency:copy-dependencies  # Copy dependencies
mvn dependency:resolve        # Resolve dependencies

# Compiler plugin
mvn compiler:compile          # Compile main sources
mvn compiler:testCompile      # Compile test sources

# Surefire plugin
mvn surefire:test            # Run unit tests

# Help plugin
mvn help:effective-pom       # Show effective POM
mvn help:active-profiles     # Show active profiles
mvn help:describe -Dplugin=compiler  # Describe plugin

# Versions plugin
mvn versions:display-dependency-updates  # Check for updates
mvn versions:display-plugin-updates      # Check plugin updates

# Spring Boot plugin
mvn spring-boot:run          # Run Spring Boot application
mvn spring-boot:build-image  # Build Docker image
```

---

### Plugin Bindings to Phases

Plugins bind their goals to specific lifecycle phases.

**Default Bindings for JAR Packaging:**

```
┌────────────────────────────────────────────────────────────┐
│              DEFAULT PLUGIN BINDINGS (JAR)                 │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  Phase              → Bound Plugin Goals                   │
│  ─────────────────────────────────────────────────────     │
│  process-resources  → resources:resources                  │
│  compile            → compiler:compile                     │
│  process-test-resources → resources:testResources         │
│  test-compile       → compiler:testCompile                │
│  test               → surefire:test                        │
│  package            → jar:jar                             │
│  install            → install:install                      │
│  deploy             → deploy:deploy                        │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**Default Bindings for WAR Packaging:**

```
process-resources  → resources:resources
compile            → compiler:compile
process-test-resources → resources:testResources
test-compile       → compiler:testCompile
test               → surefire:test
package            → war:war        ← Different!
install            → install:install
deploy             → deploy:deploy
```

**Custom Bindings:**

```xml
<build>
    <plugins>
        <!-- Bind custom goal to phase -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <version>3.1.0</version>
            <executions>
                <execution>
                    <id>custom-task</id>
                    <phase>package</phase>  ← Bind to package phase
                    <goals>
                        <goal>run</goal>     ← Execute this goal
                    </goals>
                    <configuration>
                        <target>
                            <echo>Custom task running!</echo>
                        </target>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

---

### Multiple Goals per Phase

A single phase can have multiple plugin goals bound to it.

```xml
<build>
    <plugins>
        <!-- Goal 1: JaCoCo prepare-agent (before tests) -->
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.10</version>
            <executions>
                <execution>
                    <id>prepare-agent</id>
                    <phase>test-compile</phase>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
        
        <!-- Goal 2: Additional test setup -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <version>3.1.0</version>
            <executions>
                <execution>
                    <id>setup-tests</id>
                    <phase>test-compile</phase>
                    <goals>
                        <goal>run</goal>
                    </goals>
                    <configuration>
                        <target>
                            <echo>Setting up test environment...</echo>
                        </target>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>

<!-- When running mvn test-compile:
     1. jacoco:prepare-agent executes
     2. antrun:run executes
     Both bound to test-compile phase
-->
```

---

## 5. Practical Examples

### Complete Build Workflow

```bash
# 1. Clean workspace
mvn clean

# 2. Compile and run tests
mvn test

# 3. Package application
mvn package

# 4. Run integration tests
mvn verify

# 5. Install to local repository
mvn install

# 6. Deploy to remote repository
mvn deploy

# Or all at once:
mvn clean deploy
```

---

### Development Workflow

```bash
# Quick compile check
mvn compile

# Compile and run specific test
mvn test -Dtest=UserServiceTest

# Build without tests (fast)
mvn package -DskipTests

# Full build with all tests
mvn clean verify

# Install for other local projects
mvn clean install
```

---

### CI/CD Pipeline Workflow

```bash
# Stage 1: Validate
mvn validate

# Stage 2: Compile
mvn compile

# Stage 3: Unit Tests
mvn test

# Stage 4: Package
mvn package -DskipTests

# Stage 5: Integration Tests
mvn verify

# Stage 6: Publish Artifacts
mvn deploy -DskipTests
```

---

### Multi-Module Build

```bash
# Build all modules
mvn clean install

# Build specific module and dependencies
mvn clean install -pl user-service -am

# Build specific module only
mvn clean install -pl user-service

# Build from specific module
mvn clean install -rf user-service

# Build all except specific module
mvn clean install -pl !integration-tests
```

---

## Summary

### Key Concepts

1. **Three Built-in Lifecycles:**
    
    - **Clean**: Remove build artifacts
    - **Default**: Build and deploy project
    - **Site**: Generate documentation
2. **Default Lifecycle Phases:**
    
    - validate → compile → test → package → verify → install → deploy
    - Running a phase executes all previous phases
    - Most commonly used: compile, test, package, install, deploy
3. **Phase Execution:**
    
    - Sequential: Earlier phases always run first
    - Can combine lifecycles: `mvn clean install`
    - Can skip tests: `-DskipTests` or `-Dmaven.test.skip=true`
4. **Phases vs Goals:**
    
    - **Phase**: Abstract step in lifecycle
    - **Goal**: Concrete task in plugin
    - **Binding**: Goals are bound to phases
    - Run phase: `mvn package`
    - Run goal: `mvn dependency:tree`

### Essential Commands

```bash
# Lifecycle phases
mvn clean              # Clean build artifacts
mvn compile            # Compile source
mvn test               # Run unit tests
mvn package            # Create JAR/WAR
mvn verify             # Run integration tests
mvn install            # Install to local repo
mvn deploy             # Deploy to remote repo

# Combined commands
mvn clean install      # Clean then build
mvn clean package -DskipTests  # Build without tests
mvn clean verify       # Full build with integration tests

# Plugin goals
mvn dependency:tree    # Show dependencies
mvn dependency:analyze # Analyze dependencies
mvn help:effective-pom # Show effective POM
mvn versions:display-dependency-updates  # Check updates
```

### Best Practices

```bash
# ✓ Clean before important builds
mvn clean install

# ✓ Run tests in development
mvn test

# ✓ Use verify for integration tests
mvn verify

# ✓ Skip tests for quick package (only when needed)
mvn package -DskipTests

# ✓ Install for other local projects
mvn install

# ✓ Deploy only from CI/CD
mvn deploy

# ✗ Don't skip tests in CI/CD
# ✗ Don't deploy snapshots to release repository
# ✗ Don't use install when verify is sufficient
```

