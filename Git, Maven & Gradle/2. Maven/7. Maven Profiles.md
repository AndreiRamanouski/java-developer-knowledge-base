## Overview

Maven profiles allow you to customize builds for different environments, platforms, or conditions. They enable conditional configuration without duplicating POM files.

```
┌─────────────────────────────────────────────────────────────────┐
│                    MAVEN PROFILE SYSTEM                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Base POM Configuration                                         │
│       ↓                                                         │
│  Profile Selection (dev/test/prod/ci)                          │
│       ↓                                                         │
│  Profile Activation (command line, property, auto)             │
│       ↓                                                         │
│  Merge Profile Configuration                                    │
│       ↓                                                         │
│  Effective POM                                                  │
│                                                                 │
│  Example Flow:                                                  │
│  mvn clean install -Pprod                                      │
│       ↓                                                         │
│  Activates 'prod' profile                                      │
│       ↓                                                         │
│  Uses production database                                       │
│  Enables optimizations                                          │
│  Skips development tools                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1. What are Profiles?

Profiles are alternate configurations that can be activated under specific conditions to customize the build for different scenarios.

### Why Use Profiles?

**Problem:**

```xml
<!-- Without profiles: Need different POMs for each environment -->
pom-dev.xml       → Development configuration
pom-test.xml      → Testing configuration
pom-prod.xml      → Production configuration
```

**Solution:**

```xml
<!-- With profiles: One POM, multiple configurations -->
<profiles>
    <profile><id>dev</id>...</profile>
    <profile><id>test</id>...</profile>
    <profile><id>prod</id>...</profile>
</profiles>
```

### Common Use Cases

```
Environment-specific:
  ✓ Different databases (H2 vs PostgreSQL)
  ✓ Different logging levels
  ✓ Different API endpoints
  ✓ Different build optimizations

Platform-specific:
  ✓ OS-specific dependencies
  ✓ Architecture-specific libraries
  ✓ JDK-specific configurations

Build-specific:
  ✓ Fast builds (skip tests)
  ✓ Release builds (sign artifacts)
  ✓ CI/CD builds (deploy automatically)
```

---

## 2. Profile Activation

Profiles can be activated in multiple ways.

### Activation Methods Overview

```
┌────────────────────────────────────────────────────────────┐
│              PROFILE ACTIVATION METHODS                    │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  1. Command Line        → mvn -Pdev                       │
│  2. Maven Settings      → <activeProfiles> in settings.xml│
│  3. Default Active      → <activeByDefault>               │
│  4. Property            → <property><n>env</n></property> │
│  5. JDK Version         → <jdk>17</jdk>                   │
│  6. OS                  → <os><family>unix</family></os>  │
│  7. File Presence       → <file><exists>...</exists></file>│
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

### 2.1 Command Line Activation

**Syntax:**

```bash
# Activate single profile
mvn clean install -Pdev

# Activate multiple profiles
mvn clean install -Pdev,fast-build

# Deactivate profile
mvn clean install -P!prod
```

**Example Profile:**

```xml
<profiles>
    <profile>
        <id>dev</id>
        <properties>
            <env>development</env>
            <db.url>jdbc:h2:mem:devdb</db.url>
            <logging.level>DEBUG</logging.level>
        </properties>
    </profile>
    
    <profile>
        <id>prod</id>
        <properties>
            <env>production</env>
            <db.url>jdbc:postgresql://prod-db:5432/proddb</db.url>
            <logging.level>INFO</logging.level>
        </properties>
    </profile>
</profiles>
```

**Usage:**

```bash
# Development build
mvn clean package -Pdev

# Production build
mvn clean package -Pprod

# View which profiles are active
mvn help:active-profiles
mvn help:active-profiles -Pprod
```

---

### 2.2 Default Activation

**Active by Default:**

```xml
<profile>
    <id>dev</id>
    <activation>
        <activeByDefault>true</activeByDefault>
    </activation>
    <properties>
        <env>development</env>
        <spring.profiles.active>dev</spring.profiles.active>
    </properties>
</profile>
```

**Behavior:**

```bash
# No profile specified → 'dev' activates automatically
mvn clean install

# Explicit profile → 'dev' deactivates, 'prod' activates
mvn clean install -Pprod

# Multiple profiles → 'dev' deactivates
mvn clean install -Ptest
```

**Important Note:**

```
activeByDefault is deactivated when ANY profile is explicitly activated
```

---

### 2.3 Property-Based Activation

**Activate by System Property:**

```xml
<profile>
    <id>production</id>
    <activation>
        <property>
            <n>env</n>
            <value>production</value>
        </property>
    </activation>
    <properties>
        <db.url>jdbc:postgresql://prod-db:5432/proddb</db.url>
    </properties>
</profile>
```

**Usage:**

```bash
# Activate by property
mvn clean install -Denv=production

# Check if property is defined (any value)
<activation>
    <property>
        <n>skipTests</n>
    </property>
</activation>
mvn clean install -DskipTests

# Check if property is NOT defined
<activation>
    <property>
        <n>!skipTests</n>
    </property>
</activation>
```

**Practical Example:**

```xml
<profile>
    <id>fast-build</id>
    <activation>
        <property>
            <n>fast</n>
        </property>
    </activation>
    <properties>
        <skipTests>true</skipTests>
        <maven.javadoc.skip>true</maven.javadoc.skip>
        <checkstyle.skip>true</checkstyle.skip>
    </properties>
</profile>

<!-- Usage: mvn clean package -Dfast -->
```

---

### 2.4 JDK Version Activation

**Exact Version:**

```xml
<profile>
    <id>jdk-17</id>
    <activation>
        <jdk>17</jdk>
    </activation>
    <properties>
        <maven.compiler.release>17</maven.compiler.release>
    </properties>
    <dependencies>
        <!-- JDK 17 specific dependencies -->
    </dependencies>
</profile>
```

**Version Range:**

```xml
<!-- JDK 11 or higher -->
<profile>
    <id>jdk-11-plus</id>
    <activation>
        <jdk>[11,)</jdk>
    </activation>
</profile>

<!-- JDK 8 to 11 (inclusive) -->
<profile>
    <id>jdk-8-to-11</id>
    <activation>
        <jdk>[1.8,11]</jdk>
    </activation>
</profile>

<!-- JDK 17 to 21 (exclusive) -->
<profile>
    <id>jdk-17-to-21</id>
    <activation>
        <jdk>[17,21)</jdk>
    </activation>
</profile>

<!-- Not JDK 8 -->
<profile>
    <id>not-jdk-8</id>
    <activation>
        <jdk>!1.8</jdk>
    </activation>
</profile>
```

**Version Range Syntax:**

```
[1.8]      → Exactly 1.8
[1.8,)     → 1.8 or higher
(1.8,)     → Higher than 1.8
[1.8,11]   → 1.8 to 11 (inclusive)
[1.8,11)   → 1.8 to 11 (11 exclusive)
(,1.8]     → 1.8 or lower
!1.8       → Not 1.8
```

**Practical Example:**

```xml
<profiles>
    <!-- Java 8 compatibility -->
    <profile>
        <id>java-8</id>
        <activation>
            <jdk>1.8</jdk>
        </activation>
        <dependencies>
            <dependency>
                <groupId>javax.annotation</groupId>
                <artifactId>javax.annotation-api</artifactId>
                <version>1.3.2</version>
            </dependency>
        </dependencies>
    </profile>
    
    <!-- Java 9+ modules -->
    <profile>
        <id>java-9-plus</id>
        <activation>
            <jdk>[9,)</jdk>
        </activation>
        <dependencies>
            <dependency>
                <groupId>jakarta.annotation</groupId>
                <artifactId>jakarta.annotation-api</artifactId>
                <version>2.1.1</version>
            </dependency>
        </dependencies>
    </profile>
</profiles>
```

---

### 2.5 OS-Based Activation

**Operating System Detection:**

```xml
<profile>
    <id>windows</id>
    <activation>
        <os>
            <family>windows</family>
        </os>
    </activation>
    <properties>
        <script.extension>.bat</script.extension>
        <path.separator>;</path.separator>
    </properties>
</profile>

<profile>
    <id>unix</id>
    <activation>
        <os>
            <family>unix</family>
        </os>
    </activation>
    <properties>
        <script.extension>.sh</script.extension>
        <path.separator>:</path.separator>
    </properties>
</profile>

<profile>
    <id>mac</id>
    <activation>
        <os>
            <family>mac</family>
        </os>
    </activation>
    <properties>
        <jpackage.icon>src/main/resources/icon.icns</jpackage.icon>
    </properties>
</profile>
```

**Detailed OS Matching:**

```xml
<profile>
    <id>windows-10</id>
    <activation>
        <os>
            <n>Windows 10</n>
            <family>windows</family>
            <arch>amd64</arch>
            <version>10.0</version>
        </os>
    </activation>
</profile>

<profile>
    <id>linux-64</id>
    <activation>
        <os>
            <n>Linux</n>
            <family>unix</family>
            <arch>amd64</arch>
        </os>
    </activation>
</profile>
```

**OS Families:**

```
windows   → Windows (all versions)
unix      → Linux, macOS, Solaris, BSD
mac       → macOS
linux     → Linux distributions
```

**Platform-Specific Dependencies:**

```xml
<profiles>
    <!-- Windows native libraries -->
    <profile>
        <id>windows-natives</id>
        <activation>
            <os><family>windows</family></os>
        </activation>
        <dependencies>
            <dependency>
                <groupId>org.lwjgl</groupId>
                <artifactId>lwjgl</artifactId>
                <classifier>natives-windows</classifier>
            </dependency>
        </dependencies>
    </profile>
    
    <!-- Linux native libraries -->
    <profile>
        <id>linux-natives</id>
        <activation>
            <os><family>unix</family></os>
        </activation>
        <dependencies>
            <dependency>
                <groupId>org.lwjgl</groupId>
                <artifactId>lwjgl</artifactId>
                <classifier>natives-linux</classifier>
            </dependency>
        </dependencies>
    </profile>
    
    <!-- macOS native libraries -->
    <profile>
        <id>mac-natives</id>
        <activation>
            <os><family>mac</family></os>
        </activation>
        <dependencies>
            <dependency>
                <groupId>org.lwjgl</groupId>
                <artifactId>lwjgl</artifactId>
                <classifier>natives-macos</classifier>
            </dependency>
        </dependencies>
    </profile>
</profiles>
```

---

### 2.6 File-Based Activation

**File Exists:**

```xml
<profile>
    <id>local-config</id>
    <activation>
        <file>
            <exists>config/local.properties</exists>
        </file>
    </activation>
    <properties>
        <config.file>config/local.properties</config.file>
    </properties>
</profile>
```

**File Missing:**

```xml
<profile>
    <id>generate-config</id>
    <activation>
        <file>
            <missing>src/main/resources/application.properties</missing>
        </file>
    </activation>
    <build>
        <plugins>
            <plugin>
                <artifactId>maven-resources-plugin</artifactId>
                <executions>
                    <execution>
                        <id>copy-template</id>
                        <phase>generate-resources</phase>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>src/main/resources</outputDirectory>
                            <resources>
                                <resource>
                                    <directory>templates</directory>
                                    <includes>
                                        <include>application.properties.template</include>
                                    </includes>
                                </resource>
                            </resources>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</profile>
```

**Practical Examples:**

```xml
<!-- Development: Use local config if present -->
<profile>
    <id>local-development</id>
    <activation>
        <file>
            <exists>${user.home}/.myapp/dev-config.properties</exists>
        </file>
    </activation>
    <properties>
        <config.location>${user.home}/.myapp/dev-config.properties</config.location>
    </properties>
</profile>

<!-- CI/CD: Detect CI environment file -->
<profile>
    <id>ci-build</id>
    <activation>
        <file>
            <exists>${env.CI_PROJECT_DIR}/.gitlab-ci.yml</exists>
        </file>
    </activation>
    <properties>
        <skipTests>false</skipTests>
        <sonar.enabled>true</sonar.enabled>
    </properties>
</profile>

<!-- Docker: Detect Dockerfile -->
<profile>
    <id>docker-build</id>
    <activation>
        <file>
            <exists>Dockerfile</exists>
        </file>
    </activation>
    <build>
        <plugins>
            <plugin>
                <groupId>com.spotify</groupId>
                <artifactId>dockerfile-maven-plugin</artifactId>
                <version>1.4.13</version>
            </plugin>
        </plugins>
    </build>
</profile>
```

---

### 2.7 Maven Settings Activation

**In settings.xml (~/.m2/settings.xml):**

```xml
<settings>
    <activeProfiles>
        <activeProfile>dev</activeProfile>
        <activeProfile>company-repository</activeProfile>
    </activeProfiles>
    
    <profiles>
        <profile>
            <id>company-repository</id>
            <repositories>
                <repository>
                    <id>company-nexus</id>
                    <url>https://nexus.company.com/repository/maven-public/</url>
                </repository>
            </repositories>
        </profile>
    </profiles>
</settings>
```

**Profile Priority:**

```
1. Command line (-P)
2. User settings.xml
3. Project pom.xml
4. Parent/Super POM
```

---

## 3. Profile Use Cases

### Use Case 1: Environment-Specific Databases

```xml
<profiles>
    <!-- Development: In-memory H2 -->
    <profile>
        <id>dev</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <properties>
            <spring.profiles.active>dev</spring.profiles.active>
            <db.driver>org.h2.Driver</db.driver>
            <db.url>jdbc:h2:mem:devdb</db.url>
            <db.username>sa</db.username>
            <db.password></db.password>
        </properties>
        <dependencies>
            <dependency>
                <groupId>com.h2database</groupId>
                <artifactId>h2</artifactId>
                <scope>runtime</scope>
            </dependency>
        </dependencies>
    </profile>
    
    <!-- Testing: PostgreSQL Testcontainers -->
    <profile>
        <id>test</id>
        <properties>
            <spring.profiles.active>test</spring.profiles.active>
            <db.driver>org.postgresql.Driver</db.driver>
        </properties>
        <dependencies>
            <dependency>
                <groupId>org.postgresql</groupId>
                <artifactId>postgresql</artifactId>
                <scope>runtime</scope>
            </dependency>
            <dependency>
                <groupId>org.testcontainers</groupId>
                <artifactId>postgresql</artifactId>
                <scope>test</scope>
            </dependency>
        </dependencies>
    </profile>
    
    <!-- Production: PostgreSQL -->
    <profile>
        <id>prod</id>
        <properties>
            <spring.profiles.active>prod</spring.profiles.active>
            <db.driver>org.postgresql.Driver</db.driver>
            <db.url>jdbc:postgresql://prod-db.company.com:5432/proddb</db.url>
            <db.username>${env.DB_USERNAME}</db.username>
            <db.password>${env.DB_PASSWORD}</db.password>
        </properties>
        <dependencies>
            <dependency>
                <groupId>org.postgresql</groupId>
                <artifactId>postgresql</artifactId>
                <scope>runtime</scope>
            </dependency>
        </dependencies>
        <build>
            <plugins>
                <!-- Additional security scanning for prod -->
                <plugin>
                    <groupId>org.owasp</groupId>
                    <artifactId>dependency-check-maven</artifactId>
                    <version>8.4.0</version>
                    <executions>
                        <execution>
                            <goals>
                                <goal>check</goal>
                            </goals>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </build>
    </profile>
</profiles>
```

**Resource Filtering:**

```properties
# src/main/resources/application.properties
spring.profiles.active=@spring.profiles.active@
spring.datasource.driver-class-name=@db.driver@
spring.datasource.url=@db.url@
spring.datasource.username=@db.username@
spring.datasource.password=@db.password@
```

**Usage:**

```bash
# Development (H2)
mvn spring-boot:run

# Testing (PostgreSQL with Testcontainers)
mvn clean verify -Ptest

# Production build
mvn clean package -Pprod
```

---

### Use Case 2: Fast Build Profile

```xml
<profile>
    <id>fast</id>
    <properties>
        <!-- Skip tests -->
        <skipTests>true</skipTests>
        <maven.test.skip>true</maven.test.skip>
        
        <!-- Skip documentation -->
        <maven.javadoc.skip>true</maven.javadoc.skip>
        <maven.source.skip>true</maven.source.skip>
        
        <!-- Skip code quality checks -->
        <checkstyle.skip>true</checkstyle.skip>
        <pmd.skip>true</pmd.skip>
        <spotbugs.skip>true</spotbugs.skip>
        <jacoco.skip>true</jacoco.skip>
    </properties>
</profile>
```

**Usage:**

```bash
# Fast build for local development
mvn clean package -Pfast

# Or even faster with property
mvn clean package -Dfast

# With profile activation by property
<profile>
    <id>fast</id>
    <activation>
        <property><n>fast</n></property>
    </activation>
</profile>
```

---

### Use Case 3: CI/CD Build Profile

```xml
<profile>
    <id>ci</id>
    <activation>
        <property>
            <n>env.CI</n>  <!-- Activated in CI environment -->
        </property>
    </activation>
    <properties>
        <!-- Always run tests in CI -->
        <skipTests>false</skipTests>
        
        <!-- Generate reports -->
        <maven.javadoc.skip>false</maven.javadoc.skip>
        <jacoco.skip>false</jacoco.skip>
    </properties>
    <build>
        <plugins>
            <!-- SonarQube analysis -->
            <plugin>
                <groupId>org.sonarsource.scanner.maven</groupId>
                <artifactId>sonar-maven-plugin</artifactId>
                <version>3.10.0.2594</version>
                <executions>
                    <execution>
                        <phase>verify</phase>
                        <goals>
                            <goal>sonar</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            
            <!-- Dependency vulnerability check -->
            <plugin>
                <groupId>org.owasp</groupId>
                <artifactId>dependency-check-maven</artifactId>
                <version>8.4.0</version>
                <configuration>
                    <failBuildOnCVSS>7</failBuildOnCVSS>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</profile>
```

**CI Pipeline:**

```yaml
# .gitlab-ci.yml
build:
  script:
    - mvn clean verify -Pci
    # CI profile automatically activated via env.CI
```

---

### Use Case 4: Release Profile

```xml
<profile>
    <id>release</id>
    <build>
        <plugins>
            <!-- Sign artifacts -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-gpg-plugin</artifactId>
                <version>3.1.0</version>
                <executions>
                    <execution>
                        <id>sign-artifacts</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>sign</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            
            <!-- Generate sources JAR -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-source-plugin</artifactId>
                <version>3.3.0</version>
                <executions>
                    <execution>
                        <id>attach-sources</id>
                        <goals>
                            <goal>jar-no-fork</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            
            <!-- Generate JavaDoc JAR -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-javadoc-plugin</artifactId>
                <version>3.5.0</version>
                <executions>
                    <execution>
                        <id>attach-javadocs</id>
                        <goals>
                            <goal>jar</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            
            <!-- Deploy to Maven Central -->
            <plugin>
                <groupId>org.sonatype.plugins</groupId>
                <artifactId>nexus-staging-maven-plugin</artifactId>
                <version>1.6.13</version>
                <extensions>true</extensions>
                <configuration>
                    <serverId>ossrh</serverId>
                    <nexusUrl>https://oss.sonatype.org/</nexusUrl>
                    <autoReleaseAfterClose>true</autoReleaseAfterClose>
                </configuration>
            </plugin>
        </plugins>
    </build>
</profile>
```

**Usage:**

```bash
# Release build and deploy
mvn clean deploy -Prelease
```

---

### Use Case 5: Platform-Specific Dependencies

```xml
<profiles>
    <!-- Windows -->
    <profile>
        <id>windows</id>
        <activation>
            <os><family>windows</family></os>
        </activation>
        <dependencies>
            <!-- Windows-specific JDBC driver -->
            <dependency>
                <groupId>com.microsoft.sqlserver</groupId>
                <artifactId>mssql-jdbc</artifactId>
                <version>12.4.0.jre11</version>
            </dependency>
            
            <!-- Windows native libraries -->
            <dependency>
                <groupId>net.java.dev.jna</groupId>
                <artifactId>jna-platform</artifactId>
                <version>5.13.0</version>
            </dependency>
        </dependencies>
        <properties>
            <native.library.path>C:\Program Files\MyApp\lib</native.library.path>
        </properties>
    </profile>
    
    <!-- Linux -->
    <profile>
        <id>linux</id>
        <activation>
            <os>
                <family>unix</family>
                <n>Linux</n>
            </os>
        </activation>
        <dependencies>
            <!-- Linux-specific libraries -->
            <dependency>
                <groupId>org.xerial</groupId>
                <artifactId>sqlite-jdbc</artifactId>
                <version>3.43.0.0</version>
            </dependency>
        </dependencies>
        <properties>
            <native.library.path>/usr/local/lib/myapp</native.library.path>
        </properties>
    </profile>
    
    <!-- macOS -->
    <profile>
        <id>macos</id>
        <activation>
            <os><family>mac</family></os>
        </activation>
        <properties>
            <native.library.path>/Library/Application Support/MyApp</native.library.path>
        </properties>
    </profile>
</profiles>
```

---

### Use Case 6: Different Logging Levels

```xml
<profiles>
    <!-- Development: DEBUG logging -->
    <profile>
        <id>dev</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <properties>
            <logging.level.root>DEBUG</logging.level.root>
            <logging.level.com.company>DEBUG</logging.level.com.company>
            <logging.level.org.springframework>INFO</logging.level.org.springframework>
            <logging.level.org.hibernate.SQL>DEBUG</logging.level.org.hibernate.SQL>
        </properties>
    </profile>
    
    <!-- Production: WARN logging -->
    <profile>
        <id>prod</id>
        <properties>
            <logging.level.root>WARN</logging.level.root>
            <logging.level.com.company>INFO</logging.level.com.company>
            <logging.level.org.springframework>WARN</logging.level.org.springframework>
            <logging.level.org.hibernate.SQL>WARN</logging.level.org.hibernate.SQL>
        </properties>
    </profile>
</profiles>
```

**logback.xml with filtering:**

```xml
<!-- src/main/resources/logback.xml -->
<configuration>
    <property name="ROOT_LEVEL" value="${logging.level.root:-INFO}" />
    <property name="APP_LEVEL" value="${logging.level.com.company:-INFO}" />
    
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <logger name="com.company" level="${APP_LEVEL}" />
    
    <root level="${ROOT_LEVEL}">
        <appender-ref ref="CONSOLE" />
    </root>
</configuration>
```

---

## 4. Profile Content

Profiles can contain most POM elements.

### What Profiles Can Contain

```xml
<profile>
    <id>example</id>
    
    <!-- Properties -->
    <properties>
        <property.name>value</property.name>
    </properties>
    
    <!-- Dependencies -->
    <dependencies>
        <dependency>...</dependency>
    </dependencies>
    
    <!-- Dependency Management -->
    <dependencyManagement>
        <dependencies>
            <dependency>...</dependency>
        </dependencies>
    </dependencyManagement>
    
    <!-- Repositories -->
    <repositories>
        <repository>...</repository>
    </repositories>
    
    <!-- Plugin Repositories -->
    <pluginRepositories>
        <pluginRepository>...</pluginRepository>
    </pluginRepositories>
    
    <!-- Build Configuration -->
    <build>
        <plugins>
            <plugin>...</plugin>
        </plugins>
        <pluginManagement>
            <plugins>
                <plugin>...</plugin>
            </plugins>
        </pluginManagement>
    </build>
    
    <!-- Reporting -->
    <reporting>
        <plugins>
            <plugin>...</plugin>
        </plugins>
    </reporting>
    
    <!-- Modules (in parent POM) -->
    <modules>
        <module>...</module>
    </modules>
</profile>
```

---

### Properties in Profiles

```xml
<profiles>
    <profile>
        <id>dev</id>
        <properties>
            <!-- Database -->
            <db.driver>org.h2.Driver</db.driver>
            <db.url>jdbc:h2:mem:devdb</db.url>
            <db.username>sa</db.username>
            <db.password></db.password>
            
            <!-- Application -->
            <app.name>My App (DEV)</app.name>
            <server.port>8080</server.port>
            
            <!-- Build -->
            <skipTests>false</skipTests>
            <maven.javadoc.skip>true</maven.javadoc.skip>
            
            <!-- Spring -->
            <spring.profiles.active>dev</spring.profiles.active>
        </properties>
    </profile>
</profiles>
```

---

### Dependencies in Profiles

```xml
<profiles>
    <profile>
        <id>dev</id>
        <dependencies>
            <!-- H2 for development -->
            <dependency>
                <groupId>com.h2database</groupId>
                <artifactId>h2</artifactId>
                <scope>runtime</scope>
            </dependency>
            
            <!-- Development tools -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-devtools</artifactId>
                <scope>runtime</scope>
                <optional>true</optional>
            </dependency>
        </dependencies>
    </profile>
    
    <profile>
        <id>prod</id>
        <dependencies>
            <!-- PostgreSQL for production -->
            <dependency>
                <groupId>org.postgresql</groupId>
                <artifactId>postgresql</artifactId>
                <scope>runtime</scope>
            </dependency>
        </dependencies>
    </profile>
</profiles>
```

---

### Plugin Configuration in Profiles

```xml
<profiles>
    <profile>
        <id>performance</id>
        <build>
            <plugins>
                <!-- JMH Benchmarks -->
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>exec-maven-plugin</artifactId>
                    <version>3.1.0</version>
                    <executions>
                        <execution>
                            <id>run-benchmarks</id>
                            <phase>integration-test</phase>
                            <goals>
                                <goal>exec</goal>
                            </goals>
                            <configuration>
                                <executable>java</executable>
                                <arguments>
                                    <argument>-jar</argument>
                                    <argument>target/benchmarks.jar</argument>
                                </arguments>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </build>
    </profile>
</profiles>
```

---

### Repositories in Profiles

```xml
<profiles>
    <profile>
        <id>company-internal</id>
        <repositories>
            <repository>
                <id>company-releases</id>
                <n>Company Release Repository</n>
                <url>https://nexus.company.com/repository/maven-releases/</url>
                <releases>
                    <enabled>true</enabled>
                </releases>
                <snapshots>
                    <enabled>false</enabled>
                </snapshots>
            </repository>
            
            <repository>
                <id>company-snapshots</id>
                <n>Company Snapshot Repository</n>
                <url>https://nexus.company.com/repository/maven-snapshots/</url>
                <releases>
                    <enabled>false</enabled>
                </releases>
                <snapshots>
                    <enabled>true</enabled>
                    <updatePolicy>always</updatePolicy>
                </snapshots>
            </repository>
        </repositories>
        
        <pluginRepositories>
            <pluginRepository>
                <id>company-plugins</id>
                <url>https://nexus.company.com/repository/maven-plugins/</url>
            </pluginRepository>
        </pluginRepositories>
    </profile>
</profiles>
```

---

## 5. Complete Real-World Example

### Spring Boot Microservice with Multiple Profiles

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.1.5</version>
    </parent>
    
    <groupId>com.company</groupId>
    <artifactId>user-service</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    
    <properties>
        <java.version>17</java.version>
    </properties>
    
    <dependencies>
        <!-- Spring Boot -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        
        <!-- Testing -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
    
    <profiles>
        <!-- ============================================ -->
        <!-- DEVELOPMENT PROFILE                          -->
        <!-- ============================================ -->
        <profile>
            <id>dev</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <spring.profiles.active>dev</spring.profiles.active>
                <db.driver>org.h2.Driver</db.driver>
                <db.url>jdbc:h2:mem:devdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</db.url>
                <db.username>sa</db.username>
                <db.password></db.password>
                <logging.level.root>DEBUG</logging.level.root>
                <logging.level.com.company>DEBUG</logging.level.com.company>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>com.h2database</groupId>
                    <artifactId>h2</artifactId>
                    <scope>runtime</scope>
                </dependency>
                <dependency>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-devtools</artifactId>
                    <scope>runtime</scope>
                    <optional>true</optional>
                </dependency>
            </dependencies>
        </profile>
        
        <!-- ============================================ -->
        <!-- TEST PROFILE                                 -->
        <!-- ============================================ -->
        <profile>
            <id>test</id>
            <properties>
                <spring.profiles.active>test</spring.profiles.active>
                <logging.level.root>INFO</logging.level.root>
                <logging.level.com.company>DEBUG</logging.level.com.company>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>org.postgresql</groupId>
                    <artifactId>postgresql</artifactId>
                    <scope>runtime</scope>
                </dependency>
                <dependency>
                    <groupId>org.testcontainers</groupId>
                    <artifactId>postgresql</artifactId>
                    <scope>test</scope>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.jacoco</groupId>
                        <artifactId>jacoco-maven-plugin</artifactId>
                        <version>0.8.10</version>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>prepare-agent</goal>
                                    <goal>report</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        
        <!-- ============================================ -->
        <!-- PRODUCTION PROFILE                           -->
        <!-- ============================================ -->
        <profile>
            <id>prod</id>
            <properties>
                <spring.profiles.active>prod</spring.profiles.active>
                <db.driver>org.postgresql.Driver</db.driver>
                <db.url>jdbc:postgresql://${DB_HOST}:5432/${DB_NAME}</db.url>
                <db.username>${DB_USERNAME}</db.username>
                <db.password>${DB_PASSWORD}</db.password>
                <logging.level.root>WARN</logging.level.root>
                <logging.level.com.company>INFO</logging.level.com.company>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>org.postgresql</groupId>
                    <artifactId>postgresql</artifactId>
                    <scope>runtime</scope>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <!-- Security scanning -->
                    <plugin>
                        <groupId>org.owasp</groupId>
                        <artifactId>dependency-check-maven</artifactId>
                        <version>8.4.0</version>
                        <configuration>
                            <failBuildOnCVSS>7</failBuildOnCVSS>
                        </configuration>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    
                    <!-- Docker image -->
                    <plugin>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-maven-plugin</artifactId>
                        <configuration>
                            <image>
                                <n>company/user-service:${project.version}</n>
                                <env>
                                    <BP_JVM_VERSION>17</BP_JVM_VERSION>
                                </env>
                            </image>
                        </configuration>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>build-image</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        
        <!-- ============================================ -->
        <!-- CI/CD PROFILE                                -->
        <!-- ============================================ -->
        <profile>
            <id>ci</id>
            <activation>
                <property>
                    <n>env.CI</n>
                </property>
            </activation>
            <properties>
                <skipTests>false</skipTests>
            </properties>
            <build>
                <plugins>
                    <!-- SonarQube -->
                    <plugin>
                        <groupId>org.sonarsource.scanner.maven</groupId>
                        <artifactId>sonar-maven-plugin</artifactId>
                        <version>3.10.0.2594</version>
                    </plugin>
                    
                    <!-- Test coverage enforcement -->
                    <plugin>
                        <groupId>org.jacoco</groupId>
                        <artifactId>jacoco-maven-plugin</artifactId>
                        <version>0.8.10</version>
                        <executions>
                            <execution>
                                <id>check</id>
                                <goals>
                                    <goal>check</goal>
                                </goals>
                                <configuration>
                                    <rules>
                                        <rule>
                                            <limits>
                                                <limit>
                                                    <counter>LINE</counter>
                                                    <value>COVEREDRATIO</value>
                                                    <minimum>0.80</minimum>
                                                </limit>
                                            </limits>
                                        </rule>
                                    </rules>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        
        <!-- ============================================ -->
        <!-- FAST BUILD PROFILE                           -->
        <!-- ============================================ -->
        <profile>
            <id>fast</id>
            <properties>
                <skipTests>true</skipTests>
                <maven.javadoc.skip>true</maven.javadoc.skip>
                <maven.source.skip>true</maven.source.skip>
                <checkstyle.skip>true</checkstyle.skip>
            </properties>
        </profile>
    </profiles>
    
    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

**application.properties:**

```properties
spring.application.name=user-service
spring.profiles.active=@spring.profiles.active@

# Database
spring.datasource.driver-class-name=@db.driver@
spring.datasource.url=@db.url@
spring.datasource.username=@db.username@
spring.datasource.password=@db.password@

# Logging
logging.level.root=@logging.level.root@
logging.level.com.company=@logging.level.com.company@
```

**Usage:**

```bash
# Development (default)
mvn spring-boot:run

# Testing with coverage
mvn clean verify -Ptest

# Production build
mvn clean package -Pprod

# CI build (automatically activated)
export CI=true
mvn clean verify

# Fast local build
mvn clean package -Pfast
```

---

## 6. Best Practices

### ✓ DO: Use Descriptive Profile IDs

```xml
<!-- ✓ GOOD -->
<profile><id>dev</id></profile>
<profile><id>production</id></profile>
<profile><id>fast-build</id></profile>
<profile><id>integration-test</id></profile>

<!-- ✗ BAD -->
<profile><id>p1</id></profile>
<profile><id>profile2</id></profile>
<profile><id>test123</id></profile>
```

### ✓ DO: Document Profile Purpose

```xml
<profile>
    <id>prod</id>
    <!-- 
        Production profile:
        - Uses PostgreSQL database
        - Enables security scanning
        - Builds Docker image
        - Uses WARN logging level
        
        Usage: mvn clean package -Pprod
    -->
    <properties>...</properties>
</profile>
```

### ✓ DO: Use Profiles for Environment, Not Functionality

```xml
<!-- ✓ GOOD: Environment-specific -->
<profile><id>dev</id></profile>
<profile><id>prod</id></profile>

<!-- ✗ BAD: Functionality-specific (use plugin config instead) -->
<profile><id>with-javadoc</id></profile>
<profile><id>with-sources</id></profile>
```

### ✓ DO: Keep Profile Count Manageable

```
Recommended:
  dev, test, prod (3-5 profiles)

Avoid:
  Too many profiles (10+) - hard to maintain
```

### ✓ DO: Use Properties for Reusability

```xml
<!-- ✓ GOOD -->
<profile>
    <id>prod</id>
    <properties>
        <db.host>prod-db.company.com</db.host>
        <db.port>5432</db.port>
        <db.name>proddb</db.name>
        <db.url>jdbc:postgresql://${db.host}:${db.port}/${db.name}</db.url>
    </properties>
</profile>
```

### ✗ DON'T: Duplicate Configuration

```xml
<!-- ✗ BAD: Duplicated across profiles -->
<profile>
    <id>test</id>
    <build>
        <plugins>
            <plugin><!-- long config --></plugin>
        </plugins>
    </build>
</profile>
<profile>
    <id>prod</id>
    <build>
        <plugins>
            <plugin><!-- same long config --></plugin>
        </plugins>
    </build>
</profile>

<!-- ✓ GOOD: Use pluginManagement in parent -->
<build>
    <pluginManagement>
        <plugins>
            <plugin><!-- config once --></plugin>
        </plugins>
    </pluginManagement>
</build>
```

### ✓ DO: Test Profile Activation

```bash
# Check which profiles are active
mvn help:active-profiles

# Check with specific profile
mvn help:active-profiles -Pprod

# View effective POM with profile
mvn help:effective-pom -Pprod
```

---

## Summary

### Key Concepts

1. **Profiles** enable conditional configuration
2. **Activation** can be manual, automatic, or conditional
3. **Use Cases** include environments, platforms, build types
4. **Content** can include properties, dependencies, plugins, repositories

### Activation Methods

```
Command Line:    mvn -Pdev
Default:         <activeByDefault>true</activeByDefault>
Property:        -Denv=prod
JDK:            <jdk>17</jdk>
OS:             <os><family>windows</family></os>
File:           <file><exists>...</exists></file>
Settings:        <activeProfiles> in settings.xml
```

### Essential Commands

```bash
# Activate profile
mvn clean install -Pdev

# Multiple profiles
mvn clean install -Pdev,fast

# View active profiles
mvn help:active-profiles

# View all profiles
mvn help:all-profiles

# View effective POM with profile
mvn help:effective-pom -Pprod
```

### Common Profiles

```
dev     → Development (H2, DEBUG logging, devtools)
test    → Testing (Testcontainers, coverage)
prod    → Production (PostgreSQL, security, Docker)
ci      → CI/CD (all checks, SonarQube)
fast    → Fast build (skip tests, docs)
release → Release (sign, sources, javadoc)
```
