## Overview

Dependency management is one of Maven's most powerful features. It automatically downloads, manages, and resolves dependencies and their transitive dependencies, eliminating the need to manually download JARs.

```
┌─────────────────────────────────────────────────────────────────┐
│              DEPENDENCY RESOLUTION FLOW                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Your POM declares dependency                                  │
│       ↓                                                         │
│  Check local repository (~/.m2/repository)                     │
│       ↓ (if not found)                                         │
│  Check remote repositories (Nexus, Artifactory)                │
│       ↓ (if not found)                                         │
│  Check Maven Central                                           │
│       ↓                                                         │
│  Download artifact + POM                                       │
│       ↓                                                         │
│  Resolve transitive dependencies (recursively)                 │
│       ↓                                                         │
│  Build dependency tree                                         │
│       ↓                                                         │
│  Apply conflict resolution                                     │
│       ↓                                                         │
│  Final classpath                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 1. Dependency Coordinates

Every Maven dependency is uniquely identified by its coordinates (GAV).

### GAV Coordinates

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <version>3.1.5</version>
</dependency>
```

**GAV Breakdown:**

```
┌────────────────────────────────────────────────────────────┐
│                    GAV COORDINATES                         │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  G - GroupId:    org.springframework.boot                 │
│     Who owns it? (organization/project)                    │
│     Format: reverse domain name                           │
│     Example: com.google.guava, org.apache.commons         │
│                                                            │
│  A - ArtifactId: spring-boot-starter-web                  │
│     What is it? (specific library/module)                 │
│     Format: lowercase with hyphens                        │
│     Example: commons-lang3, jackson-databind              │
│                                                            │
│  V - Version:    3.1.5                                     │
│     Which version?                                         │
│     Format: major.minor.patch[-qualifier]                 │
│     Example: 2.7.0, 1.0.0-SNAPSHOT, 3.0.0-RC1            │
│                                                            │
│  Full ID: org.springframework.boot:spring-boot-starter-web:3.1.5
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

### Classifier

Classifier distinguishes artifacts built from the same POM but with different content.

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <version>3.1.5</version>
    <classifier>sources</classifier> <!-- Source code JAR -->
</dependency>

<dependency>
    <groupId>net.java.dev.jna</groupId>
    <artifactId>jna</artifactId>
    <version>5.13.0</version>
    <classifier>platform</classifier> <!-- Platform-specific -->
</dependency>
```

**Common Classifiers:**

```
sources         → Source code JAR
javadoc         → JavaDoc JAR
tests           → Test classes JAR
test-sources    → Test source code JAR
client          → Client-side code
platform        → Platform-specific binaries
natives-linux   → Native libraries for Linux
natives-windows → Native libraries for Windows
```

**Example: LWJGL (natives for different platforms):**

```xml
<dependency>
    <groupId>org.lwjgl</groupId>
    <artifactId>lwjgl</artifactId>
    <version>3.3.2</version>
</dependency>

<!-- Platform-specific native libraries -->
<dependency>
    <groupId>org.lwjgl</groupId>
    <artifactId>lwjgl</artifactId>
    <version>3.3.2</version>
    <classifier>natives-linux</classifier>
</dependency>

<dependency>
    <groupId>org.lwjgl</groupId>
    <artifactId>lwjgl</artifactId>
    <version>3.3.2</version>
    <classifier>natives-windows</classifier>
</dependency>
```

---

### Type

Type defines the dependency packaging (default is `jar`).

```xml
<dependency>
    <groupId>com.company</groupId>
    <artifactId>my-library</artifactId>
    <version>1.0.0</version>
    <type>jar</type> <!-- default, usually omitted -->
</dependency>

<!-- POM type: for importing dependency management -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-dependencies</artifactId>
    <version>3.1.5</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>

<!-- WAR type -->
<dependency>
    <groupId>com.company</groupId>
    <artifactId>legacy-webapp</artifactId>
    <version>2.0.0</version>
    <type>war</type>
</dependency>

<!-- EJB type -->
<dependency>
    <groupId>com.company</groupId>
    <artifactId>business-logic</artifactId>
    <version>1.0.0</version>
    <type>ejb</type>
</dependency>

<!-- Test JAR -->
<dependency>
    <groupId>com.company</groupId>
    <artifactId>common-test-utils</artifactId>
    <version>1.0.0</version>
    <type>test-jar</type>
    <scope>test</scope>
</dependency>
```

**Common Types:**

```
jar        → Java Archive (default)
war        → Web Application Archive
ear        → Enterprise Archive
pom        → Project Object Model (for BOM imports)
test-jar   → JAR containing test classes
ejb        → Enterprise JavaBean
maven-plugin → Maven plugin
```

---

## 2. Dependency Scopes

Scopes control when dependencies are available and whether they're included in the final package.

```
┌─────────────────────────────────────────────────────────────────┐
│                  DEPENDENCY SCOPE MATRIX                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Scope      │ Compile │ Test │ Runtime │ Packaged │ Transitive │
│  ──────────────────────────────────────────────────────────────│
│  compile    │    ✓    │  ✓   │    ✓    │    ✓     │     ✓      │
│  provided   │    ✓    │  ✓   │    ✗    │    ✗     │     ✗      │
│  runtime    │    ✗    │  ✓   │    ✓    │    ✓     │     ✓      │
│  test       │    ✗    │  ✓   │    ✗    │    ✗     │     ✗      │
│  system     │    ✓    │  ✓   │    ✗    │    ✗     │     ✗      │
│  import     │   N/A (only for dependencyManagement)            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### Compile Scope (Default)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <version>3.1.5</version>
    <!-- <scope>compile</scope> --> <!-- Default, can be omitted -->
</dependency>
```

**Characteristics:**

- Available in **all** classpaths (compile, test, runtime)
- **Packaged** with the application
- **Transitive**: Downstream projects automatically get it
- Use for: Core application dependencies

**Examples:**

```xml
<!-- Spring Framework -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-core</artifactId>
    <version>6.0.12</version>
</dependency>

<!-- Jackson (JSON processing) -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.15.2</version>
</dependency>

<!-- Google Guava -->
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>32.1.3-jre</version>
</dependency>
```

---

### Provided Scope

```xml
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>4.0.1</version>
    <scope>provided</scope>
</dependency>
```

**Characteristics:**

- Available during **compile** and **test**
- **NOT available** at runtime
- **NOT packaged** with the application
- **NOT transitive**
- Use for: APIs provided by container/runtime

**Examples:**

```xml
<!-- Servlet API (provided by Tomcat/Jetty) -->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>4.0.1</version>
    <scope>provided</scope>
</dependency>

<!-- Lombok (compile-time annotation processor) -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.18.30</version>
    <scope>provided</scope>
</dependency>

<!-- Jakarta EE API (provided by application server) -->
<dependency>
    <groupId>jakarta.platform</groupId>
    <artifactId>jakarta.jakartaee-api</artifactId>
    <version>10.0.0</version>
    <scope>provided</scope>
</dependency>

<!-- Tomcat (when embedding in Spring Boot, but using external Tomcat) -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-tomcat</artifactId>
    <scope>provided</scope>
</dependency>
```

**When to Use Provided:**

1. APIs provided by application server (Servlet, EJB, JPA)
2. Compile-time only tools (Lombok, annotations)
3. External container provides the implementation
4. Building WAR for external Tomcat/JBoss

---

### Runtime Scope

```xml
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <version>42.6.0</version>
    <scope>runtime</scope>
</dependency>
```

**Characteristics:**

- **NOT available** during compile
- Available during **test** and **runtime**
- **Packaged** with the application
- **Transitive**: Downstream projects get it
- Use for: Implementation dependencies loaded at runtime

**Examples:**

```xml
<!-- JDBC Drivers (implementation loaded via DriverManager) -->
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <version>42.6.0</version>
    <scope>runtime</scope>
</dependency>

<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
    <version>8.1.0</version>
    <scope>runtime</scope>
</dependency>

<!-- SLF4J Implementation (compile against interface, runtime needs impl) -->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>1.4.11</version>
    <scope>runtime</scope>
</dependency>

<!-- JAXB Runtime (Java 11+) -->
<dependency>
    <groupId>org.glassfish.jaxb</groupId>
    <artifactId>jaxb-runtime</artifactId>
    <version>4.0.3</version>
    <scope>runtime</scope>
</dependency>
```

**Why Runtime Scope:**

```java
// You code against interfaces
import java.sql.Connection;
import java.sql.DriverManager;

// Runtime provides implementation
Connection conn = DriverManager.getConnection(
    "jdbc:postgresql://localhost/db", "user", "pass");
// PostgreSQL driver loaded at runtime
```

---

### Test Scope

```xml
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <version>5.10.0</version>
    <scope>test</scope>
</dependency>
```

**Characteristics:**

- **ONLY** available during **test** compile and execution
- **NOT available** during main compile or runtime
- **NOT packaged**
- **NOT transitive**
- Use for: Testing frameworks and utilities

**Examples:**

```xml
<!-- JUnit 5 -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <version>5.10.0</version>
    <scope>test</scope>
</dependency>

<!-- Mockito -->
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-core</artifactId>
    <version>5.5.0</version>
    <scope>test</scope>
</dependency>

<!-- AssertJ -->
<dependency>
    <groupId>org.assertj</groupId>
    <artifactId>assertj-core</artifactId>
    <version>3.24.2</version>
    <scope>test</scope>
</dependency>

<!-- Spring Boot Test -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <scope>test</scope>
</dependency>

<!-- H2 Database (in-memory for tests) -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>2.2.224</version>
    <scope>test</scope>
</dependency>

<!-- Testcontainers -->
<dependency>
    <groupId>org.testcontainers</groupId>
    <artifactId>postgresql</artifactId>
    <version>1.19.1</version>
    <scope>test</scope>
</dependency>
```

---

### System Scope (⚠️ Avoid)

```xml
<!-- ⚠️ NOT RECOMMENDED - Use local repository instead -->
<dependency>
    <groupId>com.oracle</groupId>
    <artifactId>ojdbc</artifactId>
    <version>19.3.0.0</version>
    <scope>system</scope>
    <systemPath>${project.basedir}/lib/ojdbc-19.3.0.0.jar</systemPath>
</dependency>
```

**Characteristics:**

- Like `provided` but from local filesystem
- Requires `<systemPath>` element
- **NOT transitive**
- **NOT portable** across environments
- **Deprecated** - avoid using

**Problems with System Scope:**

```
✗ Path must be absolute or use ${project.basedir}
✗ Not portable across machines
✗ Not in any repository
✗ Can't be deployed
✗ Maven can't manage it
✗ Build is not reproducible
```

**Better Alternatives:**

```bash
# Option 1: Install to local repository
mvn install:install-file \
  -Dfile=ojdbc-19.3.0.0.jar \
  -DgroupId=com.oracle \
  -DartifactId=ojdbc \
  -Dversion=19.3.0.0 \
  -Dpackaging=jar

# Option 2: Deploy to company repository (Nexus/Artifactory)
mvn deploy:deploy-file \
  -Dfile=ojdbc-19.3.0.0.jar \
  -DgroupId=com.oracle \
  -DartifactId=ojdbc \
  -Dversion=19.3.0.0 \
  -Dpackaging=jar \
  -Durl=https://nexus.company.com/repository/libs-release \
  -DrepositoryId=company-nexus

# Then use normal dependency
<dependency>
    <groupId>com.oracle</groupId>
    <artifactId>ojdbc</artifactId>
    <version>19.3.0.0</version>
</dependency>
```

---

### Import Scope (Special)

```xml
<!-- ONLY valid in <dependencyManagement> -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>3.1.5</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

**Characteristics:**

- **ONLY** valid in `<dependencyManagement>` section
- Must have `<type>pom</type>`
- Imports dependency management from BOM
- Does **NOT** add actual dependencies
- Use for: Bill of Materials (BOM) pattern

**Example: Using Multiple BOMs:**

```xml
<dependencyManagement>
    <dependencies>
        <!-- Spring Boot BOM -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>3.1.5</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- Spring Cloud BOM -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>2022.0.4</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- AWS SDK BOM -->
        <dependency>
            <groupId>software.amazon.awssdk</groupId>
            <artifactId>bom</artifactId>
            <version>2.20.160</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<!-- Now use without versions -->
<dependencies>
    <!-- Version from Spring Boot BOM -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <!-- Version from Spring Cloud BOM -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-config</artifactId>
    </dependency>
    
    <!-- Version from AWS SDK BOM -->
    <dependency>
        <groupId>software.amazon.awssdk</groupId>
        <artifactId>s3</artifactId>
    </dependency>
</dependencies>
```

---

## 3. Transitive Dependencies

Maven automatically resolves dependencies of your dependencies.

### How Transitive Dependencies Work

```
Your Project
  └── depends on Spring Boot Web (3.1.5)
       ├── depends on Spring Web (6.0.12)
       │   ├── depends on Spring Beans (6.0.12)
       │   └── depends on Spring Core (6.0.12)
       ├── depends on Spring WebMVC (6.0.12)
       │   └── depends on Spring Context (6.0.12)
       │        └── depends on Spring Expression (6.0.12)
       └── depends on Tomcat Embed Core (10.1.13)

All of these are automatically included!
```

**Example:**

```xml
<!-- You declare only this -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <version>3.1.5</version>
</dependency>

<!-- Maven automatically includes ~30 transitive dependencies -->
```

---

### Dependency Tree

View the complete dependency tree:

```bash
# Show dependency tree
mvn dependency:tree

# Output example:
[INFO] com.company:my-service:jar:1.0.0-SNAPSHOT
[INFO] +- org.springframework.boot:spring-boot-starter-web:jar:3.1.5:compile
[INFO] |  +- org.springframework.boot:spring-boot-starter:jar:3.1.5:compile
[INFO] |  |  +- org.springframework.boot:spring-boot:jar:3.1.5:compile
[INFO] |  |  +- org.springframework.boot:spring-boot-autoconfigure:jar:3.1.5:compile
[INFO] |  |  +- org.springframework.boot:spring-boot-starter-logging:jar:3.1.5:compile
[INFO] |  |  |  +- ch.qos.logback:logback-classic:jar:1.4.11:compile
[INFO] |  |  |  |  \- ch.qos.logback:logback-core:jar:1.4.11:compile
[INFO] |  |  |  +- org.apache.logging.log4j:log4j-to-slf4j:jar:2.20.0:compile
[INFO] |  |  |  |  \- org.apache.logging.log4j:log4j-api:jar:2.20.0:compile
[INFO] |  |  |  \- org.slf4j:jul-to-slf4j:jar:2.0.9:compile
[INFO] |  |  \- org.yaml:snakeyaml:jar:1.33:compile
[INFO] |  +- org.springframework.boot:spring-boot-starter-json:jar:3.1.5:compile
[INFO] |  +- org.springframework.boot:spring-boot-starter-tomcat:jar:3.1.5:compile
[INFO] |  +- org.springframework:spring-web:jar:6.0.12:compile
[INFO] |  \- org.springframework:spring-webmvc:jar:6.0.12:compile
```

**Useful dependency:tree options:**

```bash
# Show specific dependency
mvn dependency:tree -Dincludes=org.springframework:spring-core

# Show only specific scope
mvn dependency:tree -Dscope=compile

# Output to file
mvn dependency:tree -DoutputFile=dependency-tree.txt

# Verbose (show duplicates and conflicts)
mvn dependency:tree -Dverbose

# Show only conflicts
mvn dependency:tree -Dverbose | grep "omitted for conflict"
```

---

### Dependency Mediation

When multiple versions of the same dependency are found, Maven uses **dependency mediation** to choose one version.

#### Rule 1: Nearest Definition Wins

```
┌─────────────────────────────────────────────────────────────┐
│              NEAREST DEFINITION WINS                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Your Project                                               │
│    ├── A (depends on C v1.0) [depth=2]                     │
│    │   └── C v1.0                                          │
│    └── B (depends on C v2.0) [depth=2]                     │
│        └── C v2.0                                          │
│                                                             │
│  Both at same depth (2) → First declaration wins (C v1.0) │
│                                                             │
│  Your Project                                               │
│    ├── C v2.0 [depth=1] ← YOU declare this                │
│    └── A (depends on C v1.0) [depth=2]                     │
│        └── C v1.0                                          │
│                                                             │
│  Direct dependency (depth=1) wins → C v2.0                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**Example:**

```xml
<dependencies>
    <!-- Library A uses Guava 30.0 -->
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-a</artifactId>
        <version>1.0.0</version>
        <!-- Transitively includes Guava 30.0 -->
    </dependency>
    
    <!-- Library B uses Guava 31.0 -->
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-b</artifactId>
        <version>2.0.0</version>
        <!-- Transitively includes Guava 31.0 -->
    </dependency>
    
    <!-- YOU explicitly declare Guava 32.0 (depth=1, wins!) -->
    <dependency>
        <groupId>com.google.guava</groupId>
        <artifactId>guava</artifactId>
        <version>32.1.3-jre</version>
    </dependency>
</dependencies>

<!-- Result: Guava 32.1.3-jre is used -->
```

#### Rule 2: First Declaration Wins (Same Depth)

```xml
<dependencies>
    <!-- First dependency -->
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-a</artifactId>
        <version>1.0.0</version>
        <!-- Transitively includes Jackson 2.14.0 at depth=2 -->
    </dependency>
    
    <!-- Second dependency -->
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-b</artifactId>
        <version>2.0.0</version>
        <!-- Transitively includes Jackson 2.15.0 at depth=2 -->
    </dependency>
</dependencies>

<!-- Both Jackson versions at depth=2 -->
<!-- First declaration (from library-a) wins: Jackson 2.14.0 -->
```

**Check which version won:**

```bash
mvn dependency:tree -Dverbose

[INFO] +- com.company:library-a:jar:1.0.0:compile
[INFO] |  \- com.fasterxml.jackson.core:jackson-databind:jar:2.14.0:compile
[INFO] \- com.company:library-b:jar:2.0.0:compile
[INFO]    \- (com.fasterxml.jackson.core:jackson-databind:jar:2.15.0:compile - omitted for conflict with 2.14.0)
```

---

## 4. Dependency Conflicts

### Version Conflicts

**Problem:**

```
Your application needs:
  - Library A → requires Commons Lang 3.8
  - Library B → requires Commons Lang 3.12

Which version does Maven use?
```

**Solution 1: Explicit Declaration (Recommended)**

```xml
<dependencies>
    <!-- Explicitly declare the version you want -->
    <dependency>
        <groupId>org.apache.commons</groupId>
        <artifactId>commons-lang3</artifactId>
        <version>3.13.0</version> <!-- Latest version -->
    </dependency>
    
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-a</artifactId>
        <version>1.0.0</version>
    </dependency>
    
    <dependency>
        <groupId>com.company</groupId>
        <artifactId>library-b</artifactId>
        <version>2.0.0</version>
    </dependency>
</dependencies>
```

**Solution 2: DependencyManagement**

```xml
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-lang3</artifactId>
            <version>3.13.0</version>
        </dependency>
    </dependencies>
</dependencyManagement>

<!-- All transitive dependencies will use this version -->
```

---

### Exclusions

Exclude unwanted transitive dependencies.

**When to Use Exclusions:**

1. Exclude conflicting versions
2. Remove unused dependencies
3. Prevent duplicate implementations (e.g., multiple logging frameworks)
4. Security vulnerabilities in transitive dependencies

**Example 1: Exclude Single Dependency**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <exclusions>
        <!-- Exclude default Tomcat -->
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- Use Jetty instead -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
</dependency>
```

**Example 2: Exclude Logging Framework**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter</artifactId>
    <exclusions>
        <!-- Exclude Logback (default) -->
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-logging</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- Use Log4j2 instead -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-log4j2</artifactId>
</dependency>
```

**Example 3: Exclude Multiple Dependencies**

```xml
<dependency>
    <groupId>com.company</groupId>
    <artifactId>legacy-library</artifactId>
    <version>1.0.0</version>
    <exclusions>
        <!-- Exclude old Jackson version -->
        <exclusion>
            <groupId>org.codehaus.jackson</groupId>
            <artifactId>jackson-mapper-asl</artifactId>
        </exclusion>
        <exclusion>
            <groupId>org.codehaus.jackson</groupId>
            <artifactId>jackson-core-asl</artifactId>
        </exclusion>
        <!-- Exclude old Guava -->
        <exclusion>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- Use newer versions explicitly -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.15.2</version>
</dependency>
```

**Example 4: Wildcard Exclusion (Exclude Everything)**

```xml
<dependency>
    <groupId>com.company</groupId>
    <artifactId>standalone-library</artifactId>
    <version>1.0.0</version>
    <exclusions>
        <!-- Exclude ALL transitive dependencies -->
        <exclusion>
            <groupId>*</groupId>
            <artifactId>*</artifactId>
        </exclusion>
    </exclusions>
</dependency>
```

**Find What to Exclude:**

```bash
# See what's being pulled in
mvn dependency:tree -Dincludes=org.codehaus.jackson

# Analyze dependencies
mvn dependency:analyze

# Find duplicate classes
mvn dependency:tree -Dverbose | grep "omitted for duplicate"
```

---

### DependencyManagement for Version Control

Use `<dependencyManagement>` to centralize version control.

**Parent POM:**

```xml
<!-- company-parent/pom.xml -->
<project>
    <groupId>com.company</groupId>
    <artifactId>company-parent</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>
    
    <properties>
        <spring-boot.version>3.1.5</spring-boot.version>
        <jackson.version>2.15.2</jackson.version>
        <guava.version>32.1.3-jre</guava.version>
    </properties>
    
    <dependencyManagement>
        <dependencies>
            <!-- Spring Boot BOM -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            
            <!-- Managed versions -->
            <dependency>
                <groupId>com.fasterxml.jackson.core</groupId>
                <artifactId>jackson-databind</artifactId>
                <version>${jackson.version}</version>
            </dependency>
            
            <dependency>
                <groupId>com.google.guava</groupId>
                <artifactId>guava</artifactId>
                <version>${guava.version}</version>
            </dependency>
            
            <!-- Internal modules -->
            <dependency>
                <groupId>com.company</groupId>
                <artifactId>common-utils</artifactId>
                <version>${project.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

**Child POM:**

```xml
<!-- service/pom.xml -->
<project>
    <parent>
        <groupId>com.company</groupId>
        <artifactId>company-parent</artifactId>
        <version>1.0.0</version>
    </parent>
    
    <artifactId>user-service</artifactId>
    
    <dependencies>
        <!-- No version - from parent's dependencyManagement -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-databind</artifactId>
        </dependency>
        
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
        </dependency>
        
        <!-- Can override version if needed -->
        <dependency>
            <groupId>com.company</groupId>
            <artifactId>common-utils</artifactId>
            <version>2.0.0</version> <!-- Override parent version -->
        </dependency>
    </dependencies>
</project>
```

---

### Bill of Materials (BOM)

BOM is a special POM that provides a curated set of dependency versions.

**What is a BOM:**

```
Bill of Materials (BOM):
  - Special POM with <packaging>pom</packaging>
  - Contains only <dependencyManagement>
  - Provides tested, compatible versions
  - Imported with scope=import
  - No actual dependencies added
```

**Popular BOMs:**

```xml
<dependencyManagement>
    <dependencies>
        <!-- Spring Boot BOM -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>3.1.5</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- Spring Cloud BOM -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>2022.0.4</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- Jackson BOM -->
        <dependency>
            <groupId>com.fasterxml.jackson</groupId>
            <artifactId>jackson-bom</artifactId>
            <version>2.15.2</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- AWS SDK BOM -->
        <dependency>
            <groupId>software.amazon.awssdk</groupId>
            <artifactId>bom</artifactId>
            <version>2.20.160</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        
        <!-- JUnit BOM -->
        <dependency>
            <groupId>org.junit</groupId>
            <artifactId>junit-bom</artifactId>
            <version>5.10.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

**Creating Custom BOM:**

```xml
<!-- company-bom/pom.xml -->
<project>
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.company</groupId>
    <artifactId>company-bom</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>
    
    <name>Company BOM</name>
    <description>Centralized dependency management for all company projects</description>
    
    <properties>
        <spring-boot.version>3.1.5</spring-boot.version>
        <postgresql.version>42.6.0</postgresql.version>
        <lombok.version>1.18.30</lombok.version>
    </properties>
    
    <dependencyManagement>
        <dependencies>
            <!-- Import Spring Boot BOM -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            
            <!-- Additional managed dependencies -->
            <dependency>
                <groupId>org.postgresql</groupId>
                <artifactId>postgresql</artifactId>
                <version>${postgresql.version}</version>
            </dependency>
            
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>${lombok.version}</version>
            </dependency>
            
            <!-- Internal modules -->
            <dependency>
                <groupId>com.company</groupId>
                <artifactId>common-utils</artifactId>
                <version>${project.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

**Using Custom BOM:**

```xml
<!-- service/pom.xml -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>com.company</groupId>
            <artifactId>company-bom</artifactId>
            <version>1.0.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- All versions managed by company-bom -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <dependency>
        <groupId>org.postgresql</groupId>
        <artifactId>postgresql</artifactId>
        <scope>runtime</scope>
    </dependency>
</dependencies>
```

---

## 5. Maven Repositories

Maven uses a three-tier repository system to resolve dependencies.

```
┌─────────────────────────────────────────────────────────────────┐
│                 REPOSITORY RESOLUTION ORDER                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Local Repository (~/.m2/repository)                        │
│     ↓ (if not found)                                           │
│     Fast local cache                                           │
│     No network needed                                          │
│                                                                 │
│  2. Remote/Custom Repositories (Nexus, Artifactory)            │
│     ↓ (if not found)                                           │
│     Company/private artifacts                                  │
│     Cached public artifacts                                    │
│                                                                 │
│  3. Maven Central (repo.maven.apache.org)                      │
│     ↓                                                           │
│     Public open-source libraries                               │
│     Default repository                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### Local Repository

**Location:**

```bash
# Default location
~/.m2/repository

# Windows
C:\Users\{username}\.m2\repository

# Linux/Mac
/home/{username}/.m2/repository
```

**Structure:**

```
~/.m2/repository/
  └── org/
      └── springframework/
          └── boot/
              └── spring-boot-starter-web/
                  └── 3.1.5/
                      ├── spring-boot-starter-web-3.1.5.pom
                      ├── spring-boot-starter-web-3.1.5.jar
                      ├── spring-boot-starter-web-3.1.5-sources.jar
                      ├── spring-boot-starter-web-3.1.5-javadoc.jar
                      └── _remote.repositories
```

**Configure Custom Location:**

```xml
<!-- ~/.m2/settings.xml -->
<settings>
    <localRepository>/custom/path/to/repository</localRepository>
</settings>
```

**Clear Local Repository:**

```bash
# Delete entire repository (re-downloads everything)
rm -rf ~/.m2/repository

# Delete specific artifact
rm -rf ~/.m2/repository/org/springframework/boot

# Purge snapshots only
mvn dependency:purge-local-repository -DactTransitively=false -DreResolve=false

# Re-download dependencies
mvn clean install -U  # -U forces update
```

---

### Maven Central Repository

**URL:** https://repo.maven.apache.org/maven2

**Characteristics:**

- Default repository (configured in Super POM)
- Contains millions of open-source artifacts
- Requires no configuration
- Read-only (deploy via Sonatype OSSRH)

**Search Maven Central:**

- https://search.maven.org
- https://mvnrepository.com
- https://central.sonatype.com

**Maven Central is Configured by Default:**

```xml
<!-- From Super POM - don't need to add this -->
<repositories>
    <repository>
        <id>central</id>
        <name>Central Repository</name>
        <url>https://repo.maven.apache.org/maven2</url>
        <layout>default</layout>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
    </repository>
</repositories>
```

---

### Custom/Corporate Repositories

**In pom.xml:**

```xml
<repositories>
    <!-- Company Nexus -->
    <repository>
        <id>company-nexus</id>
        <name>Company Nexus Repository</name>
        <url>https://nexus.company.com/repository/maven-public/</url>
        <releases>
            <enabled>true</enabled>
            <updatePolicy>never</updatePolicy>
        </releases>
        <snapshots>
            <enabled>true</enabled>
            <updatePolicy>daily</updatePolicy>
        </snapshots>
    </repository>
    
    <!-- JitPack (for GitHub projects) -->
    <repository>
        <id>jitpack.io</id>
        <url>https://jitpack.io</url>
    </repository>
    
    <!-- Spring Milestones -->
    <repository>
        <id>spring-milestones</id>
        <name>Spring Milestones</name>
        <url>https://repo.spring.io/milestone</url>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
    </repository>
    
    <!-- Spring Snapshots -->
    <repository>
        <id>spring-snapshots</id>
        <name>Spring Snapshots</name>
        <url>https://repo.spring.io/snapshot</url>
        <releases>
            <enabled>false</enabled>
        </releases>
    </repository>
</repositories>

<pluginRepositories>
    <pluginRepository>
        <id>company-nexus-plugins</id>
        <url>https://nexus.company.com/repository/maven-plugins/</url>
    </pluginRepository>
</pluginRepositories>
```

**Update Policies:**

```
never       → Never check for updates (fastest)
always      → Check every build (slowest, only for snapshots)
daily       → Check once per day (good balance)
interval:X  → Check every X minutes (e.g., interval:60)
```

**Checksum Policies:**

```
fail    → Build fails if checksum doesn't match
warn    → Warning if checksum doesn't match (default)
ignore  → Ignore checksum validation
```

---

### Repository Authentication

**In settings.xml:**

```xml
<!-- ~/.m2/settings.xml -->
<settings>
    <servers>
        <server>
            <id>company-nexus</id> <!-- Must match repository id in pom.xml -->
            <username>developer</username>
            <password>secret123</password>
        </server>
        
        <!-- Or use environment variables -->
        <server>
            <id>company-nexus</id>
            <username>${env.NEXUS_USERNAME}</username>
            <password>${env.NEXUS_PASSWORD}</password>
        </server>
        
        <!-- Or use encrypted password -->
        <server>
            <id>company-nexus</id>
            <username>developer</username>
            <password>{COQLCE6DU6GtcS5P=}</password>
        </server>
    </servers>
</settings>
```

**Encrypt Passwords:**

```bash
# Create master password
mvn --encrypt-master-password
Master password: ****
{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}

# Save to ~/.m2/settings-security.xml
<settingsSecurity>
    <master>{jSMOWnoPFgsHVpMvz5VrIt5kRbzGpI8u+9EF1iFQyJQ=}</master>
</settingsSecurity>

# Encrypt server password
mvn --encrypt-password
Password: ****
{COQLCE6DU6GtcS5P=}

# Use in settings.xml
<server>
    <id>company-nexus</id>
    <username>developer</username>
    <password>{COQLCE6DU6GtcS5P=}</password>
</server>
```

---

### Repository Mirrors

**Force all requests through corporate repository:**

```xml
<!-- ~/.m2/settings.xml -->
<settings>
    <mirrors>
        <!-- Mirror Maven Central -->
        <mirror>
            <id>company-central</id>
            <name>Company Central Mirror</name>
            <url>https://nexus.company.com/repository/maven-central/</url>
            <mirrorOf>central</mirrorOf>
        </mirror>
        
        <!-- Mirror everything through single repository -->
        <mirror>
            <id>company-mirror</id>
            <name>Company Repository Mirror</name>
            <url>https://nexus.company.com/repository/maven-public/</url>
            <mirrorOf>*</mirrorOf>
        </mirror>
        
        <!-- Mirror everything EXCEPT internal -->
        <mirror>
            <id>company-external</id>
            <url>https://nexus.company.com/repository/maven-public/</url>
            <mirrorOf>*,!company-internal</mirrorOf>
        </mirror>
    </mirrors>
</settings>
```

**mirrorOf Patterns:**

```
*                  → Mirror everything
central            → Mirror only Maven Central
*,!repo1           → Mirror everything except repo1
external:*         → Mirror only external repositories
repo1,repo2        → Mirror repo1 and repo2
```

---

### Repository Priority and Order

**Resolution Order:**

```
1. Check local repository (~/.m2/repository)

2. Check repositories in pom.xml (top to bottom)
   - Project pom.xml
   - Parent pom.xml
   - Super POM

3. Check mirrors (from settings.xml)

4. Download artifact

5. Cache in local repository
```

**Example:**

```xml
<!-- pom.xml -->
<repositories>
    <repository>
        <id>repo1</id> <!-- Checked FIRST -->
        <url>https://repo1.company.com</url>
    </repository>
    <repository>
        <id>repo2</id> <!-- Checked SECOND -->
        <url>https://repo2.company.com</url>
    </repository>
    <repository>
        <id>repo3</id> <!-- Checked THIRD -->
        <url>https://repo3.company.com</url>
    </repository>
</repositories>
```

---

## Summary

### Key Concepts

1. **GAV Coordinates** uniquely identify dependencies
    
    - GroupId: Organization
    - ArtifactId: Project name
    - Version: Specific release
2. **Dependency Scopes** control availability and packaging
    
    - `compile`: Default, everywhere, packaged
    - `provided`: Compile/test only, container provides
    - `runtime`: Execution only, not needed for compilation
    - `test`: Tests only, not packaged
    - `import`: BOM pattern in dependencyManagement
3. **Transitive Dependencies** are automatically resolved
    
    - Maven downloads dependencies of dependencies
    - Use `dependency:tree` to visualize
    - Nearest definition wins conflict resolution
4. **Conflict Resolution** strategies:
    
    - Explicit declaration (override version)
    - Exclusions (remove unwanted transitives)
    - DependencyManagement (centralize versions)
    - BOM (import curated versions)
5. **Repository System** has three tiers:
    
    - Local: `~/.m2/repository` (cache)
    - Remote: Custom/corporate (Nexus/Artifactory)
    - Central: Public open-source

### Essential Commands

```bash
# View dependency tree
mvn dependency:tree

# View dependency tree with conflicts
mvn dependency:tree -Dverbose

# Analyze dependencies
mvn dependency:analyze

# Copy dependencies to target/dependency
mvn dependency:copy-dependencies

# Update snapshots
mvn clean install -U

# Purge local repository
mvn dependency:purge-local-repository

# View effective POM
mvn help:effective-pom
```

### Best Practices

```xml
<!-- ✓ Use dependencyManagement for versions -->
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
            <version>32.1.3-jre</version>
        </dependency>
    </dependencies>
</dependencyManagement>

<!-- ✓ Import BOMs for related dependencies -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-dependencies</artifactId>
    <type>pom</type>
    <scope>import</scope>
</dependency>

<!-- ✓ Use appropriate scopes -->
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter</artifactId>
    <scope>test</scope>
</dependency>

<!-- ✓ Exclude unwanted transitives -->
<dependency>
    <groupId>com.library</groupId>
    <artifactId>some-library</artifactId>
    <exclusions>
        <exclusion>
            <groupId>commons-logging</groupId>
            <artifactId>commons-logging</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- ✗ AVOID system scope -->
<!-- Use install-file or deploy to repository instead -->
```
